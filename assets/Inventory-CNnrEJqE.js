import{d as $e,u as Qe,r as a,ak as Ue,b as Le,al as Re,am as Pe,an as Be,ao as Ve,ap as Ge,s as i,j as e,R as Ke,P as K,I as re,T as le,S as de,e as ce,aq as He,X as Xe,ar as Ye,as as Je,at as We,au as Ze,av as es,aw as ss,ax as ts,ay as as}from"./index-5XOTf7Jk.js";import{M as v}from"./Modal-DhCfed7J.js";import{P as H}from"./plus-CJ5UHsdA.js";import{T as is}from"./trending-down-0Qu-oE0Y.js";import{P as oe}from"./pen-BIkIJUw_.js";import{D as X}from"./dollar-sign-BRXE0Z1w.js";import{E as xe}from"./eye-DIzLmrDE.js";import{C as ns}from"./clock-CG3Yv6II.js";import{A as rs}from"./arrow-right-Cm5K-3DB.js";const ls=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],I=$e("truck",ls);function js(){Qe();const[D,me]=a.useState([]),[m,he]=a.useState([]),[Y,ue]=a.useState([]),[f,pe]=a.useState([]),[y,ge]=a.useState([]),[g,je]=a.useState(null),[Ne,be]=a.useState(!0),[j,O]=a.useState("inventory"),[T,J]=a.useState("all"),[ve,F]=a.useState(!1),[fe,q]=a.useState(!1),[ye,w]=a.useState(!1),[we,$]=a.useState(!1),[x,ke]=a.useState(null),[N,Q]=a.useState(null),[_e,U]=a.useState([]),[o,A]=a.useState({name:"",unit:"kg",cost:""}),[k,W]=a.useState(""),[_,L]=a.useState("add"),[n,h]=a.useState({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1}),[d,S]=a.useState([]),[l,z]=a.useState({ingredient_id:0,quantity:"",unit_cost:""}),[c,R]=a.useState({cost_calculation_method:"fixed",moving_avg_months:3}),[Se,M]=a.useState(!1),[Ce,E]=a.useState(!1),[b,Z]=a.useState(null),[P,B]=a.useState("");a.useEffect(()=>{u()},[]);async function u(){try{const[s,t,r,V,p,G,Te]=await Promise.all([Ue(),Le(),Re(),Pe(),Be(),Ve(),Ge()]);me(s),he(t),ue(r),pe(V),ge(p),je(G),R(Te)}catch(s){console.error("Error loading data:",s),i("Errore nel caricamento dati","error")}finally{be(!1)}}async function Ie(){try{await ts(c),i("Impostazioni salvate","success"),M(!1)}catch(s){console.error("Error saving settings:",s),i("Errore nel salvataggio","error")}}const ee={fixed:"Costo Fisso",last:"Ultimo Costo",weighted_avg:"Media Ponderata",moving_avg:"Media Mobile"},Fe={fixed:"Il costo unitario non cambia mai automaticamente. Devi aggiornarlo manualmente.",last:"Il costo unitario viene aggiornato con il costo dell'ultima fornitura.",weighted_avg:"Il costo viene calcolato come media ponderata tra stock esistente e nuova fornitura.",moving_avg:"Il costo viene calcolato come media delle forniture degli ultimi N mesi."},C=Y.filter(s=>s.days_until_reorder<7&&s.avg_daily_consumption>0),se=T==="low"?m:D;function te(s){ke(s),W(""),L("add"),q(!0)}function ae(s){const t=f.find(r=>r.id===s.ingredient_id);t&&(Z(t),B(t.cost.toString()),E(!0))}async function qe(){if(!b||!P)return;const s=parseFloat(P);if(isNaN(s)||s<0){i("Inserisci un costo valido","warning");return}try{await as(b.id,s),i("Costo aggiornato con successo","success"),E(!1),Z(null),B(""),u()}catch(t){console.error("Error updating cost:",t),i("Errore nell'aggiornamento del costo","error")}}async function Ae(){if(!o.name.trim()){i("Inserisci un nome","warning");return}try{await We({name:o.name.trim(),unit:o.unit,cost:parseFloat(o.cost)||0}),i("Ingrediente aggiunto","success"),F(!1),A({name:"",unit:"kg",cost:""}),u()}catch(s){console.error("Error adding ingredient:",s),i("Errore nell'aggiunta","error")}}async function ze(){if(!x||!k){i("Inserisci una quantità","warning");return}const s=parseFloat(k);if(isNaN(s)||s<0){i("Inserisci un valore numerico valido","warning");return}try{const t=_==="add"?x.quantity+s:s;await Ze(x.ingredient_id,t),i("Quantità aggiornata","success"),q(!1),u()}catch(t){console.error("Error updating quantity:",t),i("Errore nell'aggiornamento","error")}}function Me(){if(!l.ingredient_id||!l.quantity||!l.unit_cost){i("Compila tutti i campi","warning");return}const s=f.find(t=>t.id===l.ingredient_id);if(s){if(d.some(t=>t.ingredient_id===l.ingredient_id)){i("Ingrediente già aggiunto","warning");return}S([...d,{ingredient_id:l.ingredient_id,ingredient_name:s.name,unit:s.unit,quantity:parseFloat(l.quantity),unit_cost:parseFloat(l.unit_cost)}]),z({ingredient_id:0,quantity:"",unit_cost:""})}}function Ee(s){S(d.filter(t=>t.ingredient_id!==s))}async function De(){if(d.length===0){i("Aggiungi almeno un ingrediente","warning");return}try{if(await es({date:n.date,supplier_name:n.supplier_name||void 0,notes:n.notes||void 0},d.map(s=>({ingredient_id:s.ingredient_id,quantity:s.quantity,unit_cost:s.unit_cost}))),n.createAsInvoice){const s=d.reduce((p,G)=>p+G.unit_cost,0),t=d.map(p=>`${p.ingredient_name} (${p.quantity} ${p.unit})`).join(", "),r=new Date,V=`FORN-${r.getFullYear()}${String(r.getMonth()+1).padStart(2,"0")}${String(r.getDate()).padStart(2,"0")}-${Date.now().toString().slice(-4)}`;await ss({date:n.date,invoice_number:V,supplier_name:n.supplier_name||"Fornitore",description:t.length>200?t.substring(0,197)+"...":t,amount:s,vat_amount:0,total:s,category:"supplies",paid:!1,notes:n.notes||"Fattura generata automaticamente da fornitura inventario"}),i("Fornitura registrata e fattura creata","success")}else i("Fornitura registrata con successo","success");w(!1),h({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1}),S([]),u()}catch(s){console.error("Error creating supply:",s),i("Errore nella creazione fornitura","error")}}async function ie(s){try{const t=await Ye(s.id);Q(s),U(t),$(!0)}catch(t){console.error("Error loading supply items:",t),i("Errore nel caricamento dettagli","error")}}async function ne(s){if(confirm("Sei sicuro di voler eliminare questa fornitura? Le quantità non verranno restituite all'inventario."))try{await Je(s),i("Fornitura eliminata","success"),u()}catch(t){console.error("Error deleting supply:",t),i("Errore nell'eliminazione","error")}}const Oe=d.reduce((s,t)=>s+t.unit_cost,0);return Ne?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white",children:"Inventario"}),e.jsx("p",{className:"text-dark-400 text-xs sm:text-sm",children:"Gestisci scorte e ottimizza riordini"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"btn-secondary btn-sm p-2",children:e.jsx(Ke,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>w(!0),className:"btn-primary btn-sm text-xs sm:text-sm",children:[e.jsx(I,{className:"w-4 h-4"}),"Fornitura"]}),e.jsxs("button",{onClick:()=>F(!0),className:"btn-secondary btn-sm text-xs sm:text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Ingrediente"})]})]})]}),e.jsxs("div",{className:"flex gap-1 sm:gap-2 border-b border-dark-700 pb-2 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:[e.jsxs("button",{onClick:()=>O("inventory"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${j==="inventory"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(K,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Scorte"]}),e.jsxs("button",{onClick:()=>O("supplies"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${j==="supplies"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(I,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),"Forniture",y.length>0&&e.jsx("span",{className:"ml-1 sm:ml-2 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:y.length})]}),e.jsxs("button",{onClick:()=>O("eoq"),className:`px-3 sm:px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap text-xs sm:text-sm ${j==="eoq"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(re,{className:"w-4 h-4 inline mr-1 sm:mr-2"}),e.jsx("span",{className:"hidden sm:inline",children:"EOQ & "}),"Riordini",C.length>0&&e.jsx("span",{className:"ml-1 sm:ml-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:C.length})]})]}),j==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Tot. Ingredienti"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:D.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Scorte Basse"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:m.length})]}),e.jsx("div",{className:`w-8 h-8 sm:w-12 sm:h-12 rounded-xl flex items-center justify-center flex-shrink-0 ${m.length>0?"bg-red-500/20":"bg-emerald-500/20"}`,children:e.jsx(le,{className:`w-4 h-4 sm:w-6 sm:h-6 ${m.length>0?"text-red-400":"text-emerald-400"}`})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Riordina (7gg)"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:C.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(is,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})})]}),m.length>0&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-3 sm:p-4",children:e.jsxs("div",{className:"flex items-start gap-2 sm:gap-3",children:[e.jsx(le,{className:"w-5 h-5 sm:w-6 sm:h-6 text-red-400 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-semibold text-red-400 text-sm sm:text-base",children:"Attenzione: Scorte Basse"}),e.jsx("p",{className:"text-xs sm:text-sm text-dark-300 truncate",children:m.map(s=>s.ingredient_name).join(", ")})]})]})}),e.jsxs("div",{className:"flex items-center gap-2 overflow-x-auto -mx-4 px-4 sm:mx-0 sm:px-0",children:[e.jsxs("button",{onClick:()=>J("all"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${T==="all"?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Tutti (",D.length,")"]}),e.jsxs("button",{onClick:()=>J("low"),className:`px-3 sm:px-4 py-1.5 sm:py-2 rounded-xl font-medium transition-all text-xs sm:text-sm whitespace-nowrap ${T==="low"?"bg-red-500 text-white":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Scorte Basse (",m.length,")"]})]}),e.jsx("div",{className:"sm:hidden space-y-2",children:se.map(s=>{const t=s.quantity<=s.threshold;return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-white text-sm",children:s.ingredient_name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded ${t?"bg-red-500/20 text-red-400":"bg-emerald-500/20 text-emerald-400"}`,children:t?"Basso":"OK"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`font-semibold ${t?"text-red-400":"text-white"}`,children:[s.quantity.toFixed(2)," ",s.unit]}),e.jsxs("span",{className:"text-dark-500 text-xs",children:["Soglia: ",s.threshold]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>te(s),className:"p-2 bg-dark-700 rounded-lg",title:"Aggiorna quantità",children:e.jsx(oe,{className:"w-4 h-4 text-dark-300"})}),e.jsx("button",{onClick:()=>ae(s),className:"p-2 bg-dark-700 rounded-lg",title:"Modifica costo",children:e.jsx(X,{className:"w-4 h-4 text-dark-300"})})]})]})]},s.id)})}),e.jsx("div",{className:"card hidden sm:block",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Quantità"}),e.jsx("th",{children:"Unità"}),e.jsx("th",{children:"Soglia"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:se.map(s=>{const t=s.quantity<=s.threshold;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${t?"text-red-400":"text-white"}`,children:s.quantity.toFixed(2)})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.unit})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400",children:s.threshold})}),e.jsx("td",{children:e.jsx("span",{className:t?"badge-danger":"badge-success",children:t?"Basso":"OK"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>te(s),className:"btn-secondary btn-sm",title:"Aggiorna quantità",children:[e.jsx(oe,{className:"w-4 h-4"}),"Qtà"]}),e.jsx("button",{onClick:()=>ae(s),className:"btn-ghost btn-sm",title:"Modifica costo unitario",children:e.jsx(X,{className:"w-4 h-4"})})]})})]},s.id)})})]})})})]}),j==="supplies"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Tot. Forniture"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:g?.suppliesCount||0})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(I,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Speso Totale"}),e.jsxs("p",{className:"stat-value text-lg sm:text-2xl",children:["€",g?.totalSpent.toFixed(0)||"0"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(de,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Media Fornitura"}),e.jsxs("p",{className:"stat-value text-lg sm:text-2xl",children:["€",g?.avgSupplyCost.toFixed(0)||"0"]})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(re,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"stat-label text-xs sm:text-sm",children:"Ingredienti"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:f.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-purple-500/20 flex items-center justify-center flex-shrink-0",children:e.jsx(K,{className:"w-4 h-4 sm:w-6 sm:h-6 text-purple-400"})})]})})]}),g&&g.topIngredients.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white text-sm sm:text-base",children:"Top Ingredienti Acquistati"})}),e.jsx("div",{className:"p-3 sm:p-4",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-2 sm:gap-3",children:g.topIngredients.map((s,t)=>e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2 sm:p-3",children:[e.jsx("p",{className:"font-medium text-white text-xs sm:text-sm truncate",children:s.ingredient_name}),e.jsxs("p",{className:"text-primary-400 font-semibold text-sm sm:text-base",children:["€",s.total_cost.toFixed(2)]}),e.jsxs("p",{className:"text-dark-400 text-xs",children:["Qty: ",s.quantity.toFixed(2)]})]},t))})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white text-sm sm:text-base",children:"Storico Forniture"}),e.jsxs("button",{onClick:()=>w(!0),className:"btn-primary btn-sm text-xs sm:text-sm",children:[e.jsx(H,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuova"})," Fornitura"]})]}),y.length===0?e.jsxs("div",{className:"p-6 sm:p-8 text-center",children:[e.jsx(I,{className:"w-10 h-10 sm:w-12 sm:h-12 text-dark-500 mx-auto mb-3"}),e.jsx("p",{className:"text-dark-400 text-sm sm:text-base",children:"Nessuna fornitura registrata"}),e.jsx("p",{className:"text-dark-500 text-xs sm:text-sm mt-1",children:'Clicca su "Nuova Fornitura" per registrare la prima'})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"sm:hidden divide-y divide-dark-700",children:y.map(s=>e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"font-medium text-white text-sm",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})}),e.jsxs("p",{className:"font-semibold text-primary-400",children:["€",s.total_cost.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx("p",{className:"text-dark-400 text-xs truncate",children:s.supplier_name||"Fornitore non spec."})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>ie(s),className:"p-2 bg-dark-700 rounded-lg",title:"Visualizza",children:e.jsx(xe,{className:"w-4 h-4 text-dark-300"})}),e.jsx("button",{onClick:()=>ne(s.id),className:"p-2 bg-red-500/20 rounded-lg",title:"Elimina",children:e.jsx(ce,{className:"w-4 h-4 text-red-400"})})]})]})]},s.id))}),e.jsx("div",{className:"table-container hidden sm:block",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Fornitore"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.supplier_name||"-"})}),e.jsx("td",{children:e.jsxs("p",{className:"font-semibold text-primary-400",children:["€",s.total_cost.toFixed(2)]})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400 text-sm truncate max-w-[200px]",children:s.notes||"-"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ie(s),className:"btn-secondary btn-sm",title:"Visualizza dettagli",children:e.jsx(xe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>ne(s.id),className:"btn-danger btn-sm",title:"Elimina",children:e.jsx(ce,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]})]}),j==="eoq"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(X,{className:"w-5 h-5 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:"Calcolo Costo Unitario"}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Metodo: ",e.jsx("span",{className:"text-primary-400",children:ee[c.cost_calculation_method]}),c.cost_calculation_method==="moving_avg"&&e.jsxs("span",{className:"text-dark-500",children:[" (",c.moving_avg_months," mesi)"]})]})]})]}),e.jsxs("button",{onClick:()=>M(!0),className:"btn-secondary flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4"}),"Configura"]})]})}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2",children:"Cos'è l'EOQ?"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["L'",e.jsx("strong",{children:"Economic Order Quantity"})," (EOQ) è la quantità ottimale da ordinare che minimizza i costi totali (costo ordine + costo stoccaggio). Il sistema analizza i consumi storici per calcolare automaticamente quando e quanto riordinare."]})]}),C.length>0&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(de,{className:"w-5 h-5 text-amber-400"}),e.jsx("h3",{className:"font-semibold text-amber-400",children:"Da riordinare nei prossimi 7 giorni"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 md:grid-cols-3 gap-3",children:C.map(s=>e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm",children:[e.jsx(ns,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{className:"text-amber-400",children:s.days_until_reorder===0?"Oggi!":`${s.days_until_reorder} giorni`})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-dark-400",children:[e.jsxs("span",{children:["Ordina: ",s.eoq.toFixed(1)]}),e.jsx(rs,{className:"w-3 h-3"}),e.jsx("span",{className:"text-emerald-400",children:"Risparmio ottimale"})]})]},s.ingredient_id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white",children:"Analisi EOQ Ingredienti"})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Stock Attuale"}),e.jsx("th",{children:"Consumo/Giorno"}),e.jsx("th",{children:"EOQ"}),e.jsx("th",{children:"Punto Riordino"}),e.jsx("th",{children:"Giorni al Riordino"}),e.jsx("th",{children:"Ordini/Anno"})]})}),e.jsx("tbody",{children:Y.map(s=>{const t=s.days_until_reorder<7&&s.avg_daily_consumption>0,r=s.avg_daily_consumption===0;return e.jsxs("tr",{className:t?"bg-amber-500/10":"",children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${s.current_stock<=s.reorder_point?"text-red-400":"text-white"}`,children:s.current_stock.toFixed(2)})}),e.jsx("td",{children:r?e.jsx("span",{className:"text-dark-500 text-sm",children:"Nessun dato"}):e.jsx("p",{className:"text-dark-300",children:s.avg_daily_consumption.toFixed(3)})}),e.jsx("td",{children:r?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-primary-400 font-semibold",children:s.eoq.toFixed(1)})}),e.jsx("td",{children:r?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-300",children:s.reorder_point.toFixed(1)})}),e.jsx("td",{children:r?e.jsx("span",{className:"text-dark-500",children:"-"}):s.days_until_reorder===1/0?e.jsx("span",{className:"badge-success",children:"OK"}):e.jsxs("span",{className:`font-semibold ${s.days_until_reorder<3?"text-red-400":s.days_until_reorder<7?"text-amber-400":"text-emerald-400"}`,children:[s.days_until_reorder," gg"]})}),e.jsx("td",{children:r?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-400",children:s.order_frequency.toFixed(1)})})]},s.ingredient_id)})})]})})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Legenda"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"EOQ"}),": Quantità ottimale da ordinare"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Punto Riordino"}),": Stock al quale effettuare l'ordine"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Scorta Sicurezza"}),": Buffer per evitare stockout"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Ordini/Anno"}),": Frequenza ordini stimata"]})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-3",children:"* I calcoli si basano sui consumi degli ultimi 30 giorni. Più ordini elabori, più precisi saranno i dati."})]})]}),e.jsx(v,{isOpen:ve,onClose:()=>F(!1),title:"Aggiungi Ingrediente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Ingrediente *"}),e.jsx("input",{type:"text",value:o.name,onChange:s=>A({...o,name:s.target.value}),className:"input",placeholder:"Es. Carne Kebab"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unità di Misura"}),e.jsxs("select",{value:o.unit,onChange:s=>A({...o,unit:s.target.value}),className:"select",children:[e.jsx("option",{value:"kg",children:"Chilogrammi (kg)"}),e.jsx("option",{value:"g",children:"Grammi (g)"}),e.jsx("option",{value:"lt",children:"Litri (lt)"}),e.jsx("option",{value:"ml",children:"Millilitri (ml)"}),e.jsx("option",{value:"pz",children:"Pezzi (pz)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Costo Unitario (€)"}),e.jsx("input",{type:"number",step:"0.01",value:o.cost,onChange:s=>A({...o,cost:s.target.value}),className:"input",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:Ae,className:"btn-primary flex-1",children:"Aggiungi"}),e.jsx("button",{onClick:()=>F(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(v,{isOpen:fe,onClose:()=>q(!1),title:`Aggiorna ${x?.ingredient_name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Quantità attuale"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[x?.quantity.toFixed(2)," ",x?.unit]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Modalità"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>L("add"),className:`py-2 rounded-xl font-medium transition-all ${_==="add"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Aggiungi"}),e.jsx("button",{onClick:()=>L("set"),className:`py-2 rounded-xl font-medium transition-all ${_==="set"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Imposta"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:_==="add"?"Quantità da aggiungere":"Nuova quantità"}),e.jsx("input",{type:"number",step:"0.01",value:k,onChange:s=>W(s.target.value),className:"input",placeholder:"0.00"})]}),_==="add"&&k&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-emerald-400",children:["Nuova quantità: ",((x?.quantity||0)+parseFloat(k||"0")).toFixed(2)," ",x?.unit]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:ze,className:"btn-primary flex-1",children:"Aggiorna"}),e.jsx("button",{onClick:()=>q(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(v,{isOpen:ye,onClose:()=>{w(!1),S([]),h({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1})},title:"Nuova Fornitura",size:"full",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data Fornitura *"}),e.jsx("input",{type:"date",value:n.date,onChange:s=>h({...n,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fornitore"}),e.jsx("input",{type:"text",value:n.supplier_name,onChange:s=>h({...n,supplier_name:s.target.value}),className:"input",placeholder:"Es. Fornitore S.r.l."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:n.notes,onChange:s=>h({...n,notes:s.target.value}),className:"input",placeholder:"Note opzionali sulla fornitura"})]}),e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Aggiungi Ingrediente"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ingrediente"}),e.jsxs("select",{value:l.ingredient_id,onChange:s=>{const t=f.find(r=>r.id===Number(s.target.value));z({...l,ingredient_id:Number(s.target.value),unit_cost:t?.cost?.toString()||""})},className:"select",children:[e.jsx("option",{value:0,children:"Seleziona ingrediente..."}),f.filter(s=>!d.some(t=>t.ingredient_id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]}),e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label",children:"Quantità"}),e.jsx("input",{type:"number",step:"0.01",value:l.quantity,onChange:s=>z({...l,quantity:s.target.value}),className:"input",placeholder:"0.00"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"label",children:"Costo Totale (€)"}),e.jsx("input",{type:"number",step:"0.01",value:l.unit_cost,onChange:s=>z({...l,unit_cost:s.target.value}),className:"input",placeholder:"0.00"})]}),e.jsx("button",{onClick:Me,className:"btn-primary h-[42px] px-4",title:"Aggiungi ingrediente",children:e.jsx(H,{className:"w-5 h-5"})})]})]})]}),d.length>0&&e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Ingredienti nella Fornitura"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:d.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"font-semibold text-primary-400",children:[s.unit_cost.toFixed(2)," €"]}),e.jsx("button",{onClick:()=>Ee(s.ingredient_id),className:"text-red-400 hover:text-red-300 p-1",children:e.jsx(Xe,{className:"w-5 h-5"})})]})]},s.ingredient_id))}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white",children:"Totale Fornitura"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[Oe.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsxs("button",{onClick:De,disabled:d.length===0,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(I,{className:"w-4 h-4"}),"Registra Fornitura"]}),e.jsx("button",{onClick:()=>{w(!1),S([]),h({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:"",createAsInvoice:!1})},className:"btn-secondary",children:"Annulla"})]}),e.jsx("div",{className:"bg-dark-900 rounded-xl p-4",children:e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:n.createAsInvoice,onChange:s=>h({...n,createAsInvoice:s.target.checked}),className:"w-5 h-5 rounded border-dark-600 bg-dark-800 text-primary-500 focus:ring-primary-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-white",children:"Crea fattura automaticamente"}),e.jsx("p",{className:"text-xs text-dark-400 mt-0.5",children:"Aggiunge questa fornitura come fattura nella sezione Ammin. & Report"})]})]})}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("strong",{children:"Nota:"})," Quando registri una fornitura, le quantità vengono automaticamente aggiunte all'inventario e i costi degli ingredienti vengono aggiornati.",n.createAsInvoice&&e.jsx("span",{className:"block mt-1",children:`Una fattura con categoria "Forniture" verrà creata automaticamente. Potrai modificare l'IVA e altri dettagli in seguito.`})]})})]})}),e.jsx(v,{isOpen:we,onClose:()=>{$(!1),Q(null),U([])},title:"Dettaglio Fornitura",size:"md",children:N&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(N.date).toLocaleDateString("it-IT",{day:"2-digit",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Fornitore"}),e.jsx("p",{className:"font-semibold text-white",children:N.supplier_name||"Non specificato"})]})]}),N.notes&&e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Note"}),e.jsx("p",{className:"text-white",children:N.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Articoli"}),e.jsx("div",{className:"space-y-2",children:_e.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit," x ",s.unit_cost.toFixed(2)," €/",s.unit]})]}),e.jsxs("p",{className:"font-semibold text-primary-400",children:[(s.total_cost||s.quantity*s.unit_cost).toFixed(2)," €"]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:"Totale"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[N.total_cost.toFixed(2)," €"]})]}),e.jsx("div",{className:"pt-4 border-t border-dark-700",children:e.jsx("button",{onClick:()=>{$(!1),Q(null),U([])},className:"btn-secondary w-full",children:"Chiudi"})})]})}),e.jsx(v,{isOpen:Se,onClose:()=>M(!1),title:"Impostazioni Costo Ingredienti",size:"xl",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Metodo di Calcolo del Costo Unitario"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:["fixed","last","weighted_avg","moving_avg"].map(s=>e.jsxs("button",{onClick:()=>R({...c,cost_calculation_method:s}),className:`w-full p-4 rounded-xl border-2 text-left transition-all ${c.cost_calculation_method===s?"border-primary-500 bg-primary-500/10":"border-dark-600 hover:border-dark-500"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${c.cost_calculation_method===s?"text-primary-400":"text-white"}`,children:ee[s]}),c.cost_calculation_method===s&&e.jsx("span",{className:"text-primary-400 text-sm",children:"✓"})]}),e.jsx("p",{className:"text-sm text-dark-400 mt-1",children:Fe[s]})]},s))})]}),c.cost_calculation_method==="moving_avg"&&e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("label",{className:"label",children:"Periodo Media Mobile"}),e.jsx("p",{className:"text-sm text-dark-400 mb-3",children:"Seleziona il numero di mesi da considerare per la media mobile (ultimi forniture nell'ultimo anno)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"range",min:"1",max:"12",value:c.moving_avg_months,onChange:s=>R({...c,moving_avg_months:parseInt(s.target.value)}),className:"flex-1 h-2 bg-dark-700 rounded-lg appearance-none cursor-pointer accent-primary-500"}),e.jsxs("div",{className:"bg-dark-800 px-4 py-2 rounded-lg min-w-[80px] text-center",children:[e.jsx("span",{className:"text-xl font-bold text-primary-400",children:c.moving_avg_months}),e.jsx("span",{className:"text-dark-400 text-sm ml-1",children:"mesi"})]})]}),e.jsxs("div",{className:"flex justify-between text-xs text-dark-500 mt-2",children:[e.jsx("span",{children:"1 mese"}),e.jsx("span",{children:"6 mesi"}),e.jsx("span",{children:"12 mesi"})]})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("strong",{children:"Nota:"})," Il metodo selezionato verrà applicato automaticamente quando registri nuove forniture. I costi esistenti non verranno ricalcolati retroattivamente."]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsx("button",{onClick:Ie,className:"btn-primary flex-1",children:"Salva Impostazioni"}),e.jsx("button",{onClick:()=>M(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(v,{isOpen:Ce,onClose:()=>E(!1),title:`Modifica Costo - ${b?.name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-dark-400",children:"Costo attuale:"}),e.jsxs("span",{className:"text-white font-semibold",children:["€",b?.cost.toFixed(2),"/",b?.unit]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"label",children:["Nuovo Costo Unitario (€/",b?.unit,")"]}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:P,onChange:s=>B(s.target.value),className:"input",placeholder:"0.00"})]})]}),e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("p",{className:"text-sm text-amber-400",children:[e.jsx("strong",{children:"Attenzione:"})," Questa modifica influenzerà il calcolo del costo dei piatti che utilizzano questo ingrediente."]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsx("button",{onClick:qe,className:"btn-primary flex-1",children:"Conferma Modifica"}),e.jsx("button",{onClick:()=>E(!1),className:"btn-secondary",children:"Annulla"})]})]})})]})}export{js as Inventory};
