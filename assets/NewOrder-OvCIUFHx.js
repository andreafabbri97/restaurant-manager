import{d as M,j as e,U as je,S as A,e as ge,f as Ne,h as ee,u as ve,i as ye,r,k as ke,l as we,m as Ce,n as Se,o as _e,p as $e,s as g,X as qe,q as Fe,t as Ie}from"./index-DEue86Wd.js";import{C as Te}from"./clock-BrUoAaou.js";import{P as ze}from"./plus-ff3pDLXI.js";import{B as Ee}from"./banknote-BJsbUg2d.js";import{S as Pe}from"./smartphone-D0OulBKx.js";const Ae=[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]],Me=M("bike",Ae);const Oe=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Be=M("chevron-up",Oe);const Ve=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],de=M("message-square",Ve);const De=[["path",{d:"M5 12h14",key:"1ays0h"}]],Ue=M("minus",De);function oe({isMobile:q=!1,orderType:d,setOrderType:N,selectedTable:O,setSelectedTable:F,tables:B,customerName:V,setCustomerName:D,customerPhone:U,setCustomerPhone:L,cart:x,cartItemsCount:R,cartTotal:i,ivaRate:Y,ivaAmount:v,grandTotal:I,expandedItemId:o,setExpandedItemId:y,notes:c,setNotes:h,paymentMethod:m,setPaymentMethod:b,smacPassed:f,setSmacPassed:k,isSubmitting:w,clearCart:H,updateQuantity:C,removeFromCart:T,updateItemNotes:S,submitOrder:z,isSessionOrder:u=!1,sessionTableName:X,orderNumber:_}){return e.jsxs("div",{className:`flex flex-col ${q?"h-full":""}`,children:[u&&e.jsx("div",{className:"p-3 bg-primary-500/10 border-b border-primary-500/30",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-primary-400 font-medium",children:["Comanda #",_]}),e.jsx("p",{className:"text-lg font-bold text-white",children:X})]}),e.jsx("div",{className:"px-3 py-1 bg-primary-500/20 rounded-lg",children:e.jsx("span",{className:"text-sm font-medium text-primary-400",children:"Conto Aperto"})})]})}),!u&&e.jsxs("div",{className:"p-3 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>N("dine_in"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${d==="dine_in"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(je,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Tavolo"})]}),e.jsxs("button",{onClick:()=>N("takeaway"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${d==="takeaway"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Te,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Asporto"})]}),e.jsxs("button",{onClick:()=>N("delivery"),className:`flex items-center justify-center gap-2 px-3 py-2.5 rounded-xl transition-all flex-1 ${d==="delivery"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Me,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Domicilio"})]})]}),d==="dine_in"&&e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{className:"text-xs text-dark-400 mb-2",children:"Seleziona tavolo:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(t=>e.jsx("button",{onClick:()=>F(t.id),className:`px-4 py-2 rounded-xl text-sm font-medium transition-all ${O===t.id?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:t.name},t.id))})]}),(d==="takeaway"||d==="delivery")&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("input",{type:"text",placeholder:"Nome cliente",value:V,onChange:t=>D(t.target.value),className:"input py-2.5 text-base"}),e.jsx("input",{type:"tel",placeholder:"Telefono",value:U,onChange:t=>L(t.target.value),className:"input py-2.5 text-base"})]})]}),e.jsxs("div",{className:"px-3 py-2 bg-dark-900/50 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-primary-400"}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[R," articoli"]})]}),x.length>0&&e.jsx("button",{onClick:H,className:"text-xs text-red-400 hover:text-red-300 transition-colors px-2 py-1",children:"Svuota"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 min-h-[150px]",children:x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-dark-400 py-8",children:[e.jsx(A,{className:"w-12 h-12 mb-3 opacity-50"}),e.jsx("p",{className:"text-sm",children:"Carrello vuoto"}),e.jsx("p",{className:"text-xs mt-1",children:"Tocca un prodotto per aggiungerlo"})]}):e.jsx("div",{className:"space-y-2",children:x.map(t=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-medium text-white text-sm truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-primary-400 mt-0.5",children:["â‚¬",t.price.toFixed(2)," Ã— ",t.quantity," = â‚¬",(t.price*t.quantity).toFixed(2)]}),t.notes&&o!==t.id&&e.jsxs("p",{className:"text-xs text-amber-400 mt-1 truncate",children:["ðŸ“ ",t.notes]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("button",{onClick:()=>y(o===t.id?null:t.id),className:`w-9 h-9 rounded-lg flex items-center justify-center transition-colors ${o===t.id||t.notes?"bg-amber-500/20 text-amber-400":"bg-dark-700 text-dark-400 hover:bg-dark-600"}`,children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>C(t.id,-1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx("span",{className:"w-8 text-center text-base font-semibold",children:t.quantity}),e.jsx("button",{onClick:()=>C(t.id,1),className:"w-9 h-9 rounded-lg bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors",children:e.jsx(ze,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>T(t.id),className:"w-9 h-9 ml-1 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors flex items-center justify-center",children:e.jsx(ge,{className:"w-4 h-4"})})]})]}),o===t.id&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(de,{className:"w-4 h-4 text-amber-400"}),e.jsx("span",{className:"text-xs text-amber-400 font-medium",children:"Note / Variazioni"})]}),e.jsx("input",{type:"text",value:t.notes||"",onChange:p=>S(t.id,p.target.value),placeholder:"Es: senza cipolla, piccante...",className:"w-full bg-dark-800 border border-dark-600 rounded-lg px-3 py-2 text-sm text-white placeholder-dark-500 focus:outline-none focus:border-amber-500"}),e.jsx("div",{className:"flex flex-wrap gap-1.5 mt-2",children:["Senza cipolla","Piccante","Extra salsa","Ben cotto"].map(p=>e.jsxs("button",{onClick:()=>{const $=t.notes||"",G=$?`${$}, ${p}`:p;S(t.id,G)},className:"px-2.5 py-1 text-xs bg-dark-700 text-dark-300 rounded-lg hover:bg-dark-600 transition-colors",children:["+ ",p]},p))})]})]},t.id))})}),x.length>0&&e.jsxs("div",{className:"border-t border-dark-700 bg-dark-800",children:[e.jsx("div",{className:"px-3 py-2 border-b border-dark-700",children:e.jsx("input",{type:"text",placeholder:"Note ordine (opzionale)...",value:c,onChange:t=>h(t.target.value),className:"input py-2.5 text-base"})}),!u&&e.jsxs("div",{className:"px-3 py-3 flex items-center gap-2 border-b border-dark-700",children:[e.jsxs("div",{className:"flex gap-2 flex-1",children:[e.jsxs("button",{onClick:()=>b("cash"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${m==="cash"?"bg-emerald-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Ee,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Contanti"})]}),e.jsxs("button",{onClick:()=>b("card"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${m==="card"?"bg-blue-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Ne,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Carta"})]}),e.jsxs("button",{onClick:()=>b("online"),className:`flex items-center justify-center gap-1.5 px-3 py-2 rounded-xl transition-all flex-1 ${m==="online"?"bg-purple-500 text-white":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[e.jsx(Pe,{className:"w-5 h-5"}),e.jsx("span",{className:"text-xs font-medium",children:"Online"})]})]}),e.jsxs("button",{onClick:()=>k(!f),className:`flex items-center gap-1.5 px-4 py-2 rounded-xl transition-all ${f?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:[f&&e.jsx(ee,{className:"w-4 h-4"}),e.jsx("span",{className:"text-xs font-medium",children:"SMAC"})]})]}),e.jsx("div",{className:"px-3 py-3 space-y-1",children:u?e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white",children:[e.jsx("span",{children:"Totale Comanda"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",i.toFixed(2)]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsx("span",{children:"Subtotale"}),e.jsxs("span",{children:["â‚¬",i.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-dark-400",children:[e.jsxs("span",{children:["IVA (",Y,"%)"]}),e.jsxs("span",{children:["â‚¬",v.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold text-white pt-2",children:[e.jsx("span",{children:"Totale"}),e.jsxs("span",{className:"text-primary-400",children:["â‚¬",I.toFixed(2)]})]})]})}),e.jsx("div",{className:"p-3 pt-0 pb-safe",children:e.jsx("button",{onClick:z,disabled:x.length===0||w,className:"btn-primary w-full py-4 text-base font-semibold",children:w?e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-dark-900"}):u?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5"}),"Invia Comanda #",_," - â‚¬",i.toFixed(2)]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-5 h-5"}),"Conferma Ordine - â‚¬",I.toFixed(2)]})})})]}),x.length===0&&e.jsx("div",{className:"p-3 border-t border-dark-700 pb-safe",children:e.jsxs("button",{disabled:!0,className:"btn-primary w-full py-4 opacity-50 cursor-not-allowed text-base",children:[e.jsx(A,{className:"w-5 h-5"}),"Aggiungi prodotti"]})})]})}function Ge(){const q=ve(),[d]=ye(),[N,O]=r.useState([]),[F,B]=r.useState([]),[V,D]=r.useState([]),[U,L]=r.useState(null),[x,R]=r.useState(!0),[i,Y]=r.useState(null),[v,I]=r.useState(1),[o,y]=r.useState(null),[c,h]=r.useState([]),[m,b]=r.useState("dine_in"),[f,k]=r.useState(null),[w,H]=r.useState("cash"),[C,T]=r.useState(""),[S,z]=r.useState(""),[u,X]=r.useState(""),[_,t]=r.useState(!1),[p,$]=r.useState(!1),[G,se]=r.useState(null),[ce,J]=r.useState(!1),K=d.get("session"),Q=d.get("table");r.useEffect(()=>{xe()},[K,Q]);async function xe(){try{const[s,a,l,n]=await Promise.all([ke(),we(),Ce(),Se()]);if(O(s),B(a),D(l),L(n),s.length>0&&y(s[0].id),K){const ie=parseInt(K),j=await _e(ie);if(j){Y(j),k(j.table_id),b("dine_in");const fe=await $e(ie);I(fe),j.customer_name&&T(j.customer_name),j.customer_phone&&z(j.customer_phone)}}else Q&&(k(parseInt(Q)),b("dine_in"))}catch(s){console.error("Error loading data:",s),g("Errore nel caricamento dati","error")}finally{R(!1)}}const te=o?F.filter(s=>s.category_id===o&&s.available):F.filter(s=>s.available),E=c.reduce((s,a)=>s+a.price*a.quantity,0),P=c.reduce((s,a)=>s+a.quantity,0),ae=U?.iva_rate||17,re=E*(ae/100),W=E+re;function ne(s){h(a=>a.find(n=>n.id===s.id)?a.map(n=>n.id===s.id?{...n,quantity:n.quantity+1}:n):[...a,{...s,quantity:1}]),g(`${s.name} aggiunto`,"success")}function me(s,a){h(l=>l.map(n=>n.id===s?{...n,quantity:Math.max(0,n.quantity+a)}:n).filter(n=>n.quantity>0))}function ue(s){h(a=>a.filter(l=>l.id!==s))}function pe(s,a){h(l=>l.map(n=>n.id===s?{...n,notes:a}:n))}function he(){h([]),se(null)}async function be(){if(c.length===0){g("Aggiungi almeno un prodotto","warning");return}if(m==="dine_in"&&!f&&!i){g("Seleziona un tavolo","warning");return}$(!0);try{const s={date:new Date().toISOString().split("T")[0],total:i?E:W,payment_method:i?"cash":w,order_type:m,table_id:m==="dine_in"?f??void 0:void 0,notes:u||void 0,status:"pending",smac_passed:i?!1:_,customer_name:C||void 0,customer_phone:S||void 0,session_id:i?.id,order_number:i?v:void 0},a=c.map(l=>({menu_item_id:l.id,quantity:l.quantity,price:l.price,notes:l.notes}));await Fe(s,a),i?(await Ie(i.id),g(`Comanda #${v} inviata!`,"success"),q("/tables")):(g("Ordine creato con successo!","success"),q("/orders"))}catch(s){console.error("Error creating order:",s),g("Errore nella creazione dell'ordine","error")}finally{$(!1)}}if(x)return e.jsx("div",{className:"flex items-center justify-center h-[calc(100vh-200px)]",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})});const Z=!!i,le={orderType:m,setOrderType:Z?()=>{}:b,selectedTable:f,setSelectedTable:Z?()=>{}:k,tables:V,customerName:C,setCustomerName:T,customerPhone:S,setCustomerPhone:z,cart:c,cartItemsCount:P,cartTotal:E,ivaRate:ae,ivaAmount:re,grandTotal:W,expandedItemId:G,setExpandedItemId:se,notes:u,setNotes:X,paymentMethod:w,setPaymentMethod:H,smacPassed:_,setSmacPassed:t,isSubmitting:p,clearCart:he,updateQuantity:me,removeFromCart:ue,updateItemNotes:pe,submitOrder:be,isSessionOrder:Z,sessionTableName:i?.table_name,orderNumber:v};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"hidden lg:flex gap-4 h-[calc(100vh-100px)]",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsx("div",{className:"flex gap-2 mb-4 overflow-x-auto pb-2",children:N.map(s=>e.jsx("button",{onClick:()=>y(s.id),className:`px-6 py-3 rounded-xl font-medium whitespace-nowrap transition-all ${o===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4",children:te.map(s=>e.jsxs("button",{onClick:()=>ne(s),className:"menu-item-card text-left",children:[e.jsx("h3",{className:"font-semibold text-white mb-1 line-clamp-2",children:s.name}),s.description&&e.jsx("p",{className:"text-sm text-dark-400 mb-2 line-clamp-2",children:s.description}),e.jsxs("p",{className:"text-xl font-bold text-primary-400",children:["â‚¬",s.price.toFixed(2)]})]},s.id))})})]}),e.jsx("div",{className:"w-[420px] flex flex-col bg-dark-800 rounded-2xl border border-dark-700",children:e.jsx(oe,{...le})})]}),e.jsxs("div",{className:"lg:hidden flex flex-col h-[calc(100vh-120px)]",children:[e.jsx("div",{className:"flex gap-2 mb-3 overflow-x-auto pb-2 -mx-3 px-3",children:N.map(s=>e.jsx("button",{onClick:()=>y(s.id),className:`px-4 py-2.5 rounded-xl font-medium whitespace-nowrap transition-all text-sm ${o===s.id?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300"}`,children:s.name},s.id))}),e.jsx("div",{className:"flex-1 overflow-y-auto -mx-3 px-3 pb-24",children:e.jsx("div",{className:"grid grid-cols-2 gap-2",children:te.map(s=>{const a=c.find(l=>l.id===s.id);return e.jsxs("button",{onClick:()=>ne(s),className:"relative bg-dark-800 rounded-xl p-3 text-left active:scale-[0.98] transition-transform border border-dark-700",children:[a&&e.jsx("div",{className:"absolute -top-2 -right-2 w-6 h-6 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900",children:a.quantity}),e.jsx("h3",{className:"font-semibold text-white text-sm line-clamp-2 mb-1",children:s.name}),e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:["â‚¬",s.price.toFixed(2)]})]},s.id)})})}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-dark-900 border-t border-dark-700 lg:hidden z-30 safe-bottom",children:e.jsxs("button",{onClick:()=>J(!0),className:"w-full flex items-center justify-between p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(A,{className:"w-6 h-6 text-primary-400"}),P>0&&e.jsx("span",{className:"absolute -top-2 -right-2 w-5 h-5 bg-primary-500 rounded-full flex items-center justify-center text-xs font-bold text-dark-900",children:P})]}),e.jsx("span",{className:"text-white font-medium",children:c.length===0?"Carrello vuoto":`${P} articoli`})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xl font-bold text-primary-400",children:["â‚¬",W.toFixed(2)]}),e.jsx(Be,{className:"w-5 h-5 text-dark-400"})]})]})}),ce&&e.jsxs("div",{className:"fixed inset-0 z-50 lg:hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>J(!1)}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-dark-800 rounded-t-3xl max-h-[90vh] flex flex-col animate-slide-up",children:[e.jsx("div",{className:"flex justify-center pt-3 pb-1",children:e.jsx("div",{className:"w-12 h-1.5 bg-dark-600 rounded-full"})}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 border-b border-dark-700",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Il tuo ordine"}),e.jsx("button",{onClick:()=>J(!1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(qe,{className:"w-6 h-6 text-dark-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx(oe,{...le,isMobile:!0})})]})]})]}),e.jsx("style",{children:`
        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
        .animate-slide-up {
          animation: slide-up 0.3s ease-out;
        }
        .safe-bottom {
          padding-bottom: env(safe-area-inset-bottom, 0);
        }
        .pb-safe {
          padding-bottom: env(safe-area-inset-bottom, 12px);
        }
      `})]})}export{Ge as NewOrder};
