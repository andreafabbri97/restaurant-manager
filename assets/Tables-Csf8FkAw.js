import{d as $,r as l,l as q,E as L,o as G,s as n,j as e,U,e as H,X as J,F as X,G as B,H as K,I as Q,J as V}from"./index-CkC1_jyi.js";import{M as f}from"./Modal-BAfP4u6K.js";import{P as W}from"./plus-CGOSodOK.js";import{C as Y}from"./calendar-nsN6iMMd.js";import{P as Z}from"./pen-BrIsXUx_.js";import{C as ee}from"./clock-Cb5VLSEn.js";const ae=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],se=$("phone",ae);function oe(){const[y,w]=l.useState([]),[u,T]=l.useState([]),[g,C]=l.useState([]),[k,S]=l.useState(!0),[c,_]=l.useState(new Date().toISOString().split("T")[0]),[E,x]=l.useState(!1),[P,h]=l.useState(!1),[p,N]=l.useState(null),[o,v]=l.useState({name:"",capacity:"4"}),[s,i]=l.useState({table_id:0,date:new Date().toISOString().split("T")[0],time:"19:00",customer_name:"",phone:"",guests:"2",notes:""});l.useEffect(()=>{m()},[c]);async function m(){try{const[a,t,d]=await Promise.all([q(),L(c),G(c)]);w(a),T(t),C(d.filter(r=>r.status!=="delivered"&&r.status!=="cancelled"))}catch(a){console.error("Error loading data:",a),n("Errore nel caricamento dati","error")}finally{S(!1)}}function O(a){return g.some(r=>r.table_id===a)?"occupied":u.some(r=>r.table_id===a&&r.status==="confirmed")?"reserved":"available"}function R(a){return g.find(t=>t.table_id===a)}function z(a){return u.find(t=>t.table_id===a&&t.status==="confirmed")}function b(a){a?(N(a),v({name:a.name,capacity:a.capacity.toString()})):(N(null),v({name:"",capacity:"4"})),x(!0)}function D(a){i({...s,table_id:a,date:c}),h(!0)}async function M(){if(!o.name.trim()){n("Inserisci un nome per il tavolo","warning");return}try{const a={name:o.name.trim(),capacity:parseInt(o.capacity)||4};p?(await K(p.id,a),n("Tavolo aggiornato","success")):(await Q(a),n("Tavolo creato","success")),x(!1),m()}catch(a){console.error("Error saving table:",a),n("Errore nel salvataggio","error")}}async function A(a){if(confirm("Sei sicuro di voler eliminare questo tavolo?"))try{await X(a),n("Tavolo eliminato","success"),m()}catch(t){console.error("Error deleting table:",t),n("Errore nell'eliminazione","error")}}async function I(){if(!s.customer_name.trim()){n("Inserisci il nome del cliente","warning");return}try{await V({table_id:s.table_id,date:s.date,time:s.time,customer_name:s.customer_name.trim(),phone:s.phone,guests:parseInt(s.guests)||2,notes:s.notes||void 0,status:"confirmed"}),n("Prenotazione creata","success"),h(!1),i({table_id:0,date:c,time:"19:00",customer_name:"",phone:"",guests:"2",notes:""}),m()}catch(a){console.error("Error creating reservation:",a),n("Errore nella creazione","error")}}async function F(a){if(confirm("Annullare questa prenotazione?"))try{await B(a),n("Prenotazione annullata","success"),m()}catch(t){console.error("Error cancelling reservation:",t),n("Errore nell'annullamento","error")}}return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Tavoli"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Gestisci tavoli e prenotazioni"})]}),e.jsxs("button",{onClick:()=>b(),className:"btn-primary",children:[e.jsx(W,{className:"w-5 h-5"}),"Nuovo Tavolo"]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Y,{className:"w-5 h-5 text-dark-400"}),e.jsx("input",{type:"date",value:c,onChange:a=>_(a.target.value),className:"input w-auto"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-emerald-500"}),e.jsx("span",{className:"text-sm text-dark-300",children:"Disponibile"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),e.jsx("span",{className:"text-sm text-dark-300",children:"Occupato"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 rounded bg-amber-500"}),e.jsx("span",{className:"text-sm text-dark-300",children:"Prenotato"})]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4",children:y.map(a=>{const t=O(a.id),d=R(a.id),r=z(a.id);return e.jsxs("div",{className:`
                ${t==="available"?"table-available":""}
                ${t==="occupied"?"table-occupied":""}
                ${t==="reserved"?"table-reserved":""}
                p-4
              `,children:[e.jsx("h3",{className:"text-lg font-bold",children:a.name}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(U,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm",children:a.capacity})]}),d&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsxs("p",{children:["Ordine #",d.id]}),e.jsxs("p",{className:"font-semibold",children:["€",d.total.toFixed(2)]})]}),r&&!d&&e.jsxs("div",{className:"mt-2 text-xs",children:[e.jsx("p",{children:r.customer_name}),e.jsx("p",{children:r.time})]}),t==="available"&&e.jsx("button",{onClick:()=>D(a.id),className:"mt-3 text-xs underline hover:no-underline",children:"Prenota"}),e.jsxs("div",{className:"absolute top-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),b(a)},className:"p-1 bg-dark-800 rounded hover:bg-dark-700",children:e.jsx(Z,{className:"w-3 h-3"})}),e.jsx("button",{onClick:j=>{j.stopPropagation(),A(a.id)},className:"p-1 bg-dark-800 rounded hover:bg-red-500/20",children:e.jsx(H,{className:"w-3 h-3"})})]})]},a.id)})}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white",children:["Prenotazioni per ",new Date(c).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long"})]})}),e.jsx("div",{className:"card-body",children:u.length===0?e.jsx("p",{className:"text-dark-400 text-center py-4",children:"Nessuna prenotazione per questa data"}):e.jsx("div",{className:"space-y-3",children:u.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-dark-900 rounded-xl",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-white",children:a.customer_name}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-dark-400",children:[e.jsx("span",{children:a.time}),e.jsx("span",{children:a.table_name}),e.jsxs("span",{children:[a.guests," ospiti"]})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-1 text-sm text-dark-400",children:[e.jsx(se,{className:"w-3 h-3"}),a.phone]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`badge ${a.status==="confirmed"?"badge-success":"badge-danger"}`,children:a.status==="confirmed"?"Confermata":"Annullata"}),a.status==="confirmed"&&e.jsx("button",{onClick:()=>F(a.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:e.jsx(J,{className:"w-5 h-5 text-red-400"})})]})]},a.id))})})]}),e.jsx(f,{isOpen:E,onClose:()=>x(!1),title:p?"Modifica Tavolo":"Nuovo Tavolo",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Tavolo"}),e.jsx("input",{type:"text",value:o.name,onChange:a=>v({...o,name:a.target.value}),className:"input",placeholder:"Es. Tavolo 1"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Capacità (posti)"}),e.jsx("input",{type:"number",min:"1",value:o.capacity,onChange:a=>v({...o,capacity:a.target.value}),className:"input"})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:M,className:"btn-primary flex-1",children:p?"Salva":"Crea"}),e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(f,{isOpen:P,onClose:()=>h(!1),title:"Nuova Prenotazione",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data"}),e.jsx("input",{type:"date",value:s.date,onChange:a=>i({...s,date:a.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ora"}),e.jsx("input",{type:"time",value:s.time,onChange:a=>i({...s,time:a.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Cliente *"}),e.jsx("input",{type:"text",value:s.customer_name,onChange:a=>i({...s,customer_name:a.target.value}),className:"input",placeholder:"Nome e cognome"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:s.phone,onChange:a=>i({...s,phone:a.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ospiti"}),e.jsx("input",{type:"number",min:"1",value:s.guests,onChange:a=>i({...s,guests:a.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:s.notes,onChange:a=>i({...s,notes:a.target.value}),className:"input resize-none h-20",placeholder:"Note aggiuntive..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:I,className:"btn-primary flex-1",children:"Crea Prenotazione"}),e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Annulla"})]})]})})]})}export{oe as Tables};
