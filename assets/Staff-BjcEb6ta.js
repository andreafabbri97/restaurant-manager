import{d as S,r as i,aj as $,ak as R,s as n,j as e,U as q,e as G,al as H,am as U,an as V,ao as B}from"./index-Bui9AK7p.js";import{M as w}from"./Modal--abPZav2.js";import{C as k}from"./calendar-Dlq-9o1j.js";import{P as _}from"./plus-CrvXw7TW.js";import{D as J}from"./dollar-sign-PyjyTyVX.js";import{P as K}from"./pen-CTMkbn9y.js";const Q=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],X=S("chevron-left",Q);const Y=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Z=S("chevron-right",Y);function ie(){const[h,D]=i.useState([]),[C,E]=i.useState([]),[T,M]=i.useState(!0),[o,I]=i.useState(f(new Date)),[F,x]=i.useState(!1),[z,u]=i.useState(!1),[p,g]=i.useState(null),[a,c]=i.useState({name:"",role:"",hourly_rate:"",phone:"",email:"",active:!0}),[s,d]=i.useState({employee_id:0,date:new Date().toISOString().split("T")[0],start_time:"09:00",end_time:"17:00",shift_type:"worked",notes:""});function f(t){const l=[],r=new Date(t);r.setDate(r.getDate()-r.getDay()+1);for(let m=0;m<7;m++){const v=new Date(r);v.setDate(r.getDate()+m),l.push(v.toISOString().split("T")[0])}return l}function N(t){const l=new Date(o[0]);l.setDate(l.getDate()+t*7),I(f(l))}i.useEffect(()=>{j()},[o]);async function j(){try{const[t,l]=await Promise.all([$(),R(o[0],o[6])]);D(t),E(l)}catch(t){console.error("Error loading data:",t),n("Errore nel caricamento dati","error")}finally{M(!1)}}function y(t){t?(g(t),c({name:t.name,role:t.role,hourly_rate:t.hourly_rate.toString(),phone:t.phone||"",email:t.email||"",active:t.active})):(g(null),c({name:"",role:"",hourly_rate:"",phone:"",email:"",active:!0})),x(!0)}function b(t,l){d({employee_id:t||h[0]?.id||0,date:l||new Date().toISOString().split("T")[0],start_time:"09:00",end_time:"17:00",shift_type:"worked",notes:""}),u(!0)}async function L(){if(!a.name.trim()||!a.role.trim()){n("Compila nome e ruolo","warning");return}try{const t={name:a.name.trim(),role:a.role.trim(),hourly_rate:parseFloat(a.hourly_rate)||10,phone:a.phone||void 0,email:a.email||void 0,active:a.active};p?(await U(p.id,t),n("Dipendente aggiornato","success")):(await V(t),n("Dipendente aggiunto","success")),x(!1),j()}catch(t){console.error("Error saving employee:",t),n("Errore nel salvataggio","error")}}async function W(t){if(confirm("Sei sicuro di voler eliminare questo dipendente?"))try{await H(t),n("Dipendente eliminato","success"),j()}catch(l){console.error("Error deleting employee:",l),n("Errore nell'eliminazione","error")}}async function O(){if(!s.employee_id){n("Seleziona un dipendente","warning");return}try{const t=parseInt(s.start_time.split(":")[0]),l=parseInt(s.end_time.split(":")[0]),r=parseInt(s.start_time.split(":")[1])/60,m=parseInt(s.end_time.split(":")[1])/60,v=l+m-(t+r);await B({employee_id:s.employee_id,date:s.date,hours_worked:v,status:"scheduled",shift_type:s.shift_type,notes:s.notes||void 0,start_time:s.start_time,end_time:s.end_time}),n("Turno aggiunto","success"),u(!1),j()}catch(t){console.error("Error saving shift:",t),n("Errore nel salvataggio","error")}}function P(t,l){return C.find(r=>r.employee_id===t&&r.date===l)}const A=["Lun","Mar","Mer","Gio","Ven","Sab","Dom"];return T?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Personale"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Gestisci dipendenti e turni"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>b(),className:"btn-secondary",children:[e.jsx(k,{className:"w-5 h-5"}),"Nuovo Turno"]}),e.jsxs("button",{onClick:()=>y(),className:"btn-primary",children:[e.jsx(_,{className:"w-5 h-5"}),"Nuovo Dipendente"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Dipendenti"]})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:h.map(t=>e.jsxs("div",{className:`bg-dark-900 rounded-xl p-4 ${t.active?"":"opacity-50"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white",children:t.name}),e.jsx("p",{className:"text-sm text-primary-400",children:t.role}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-sm text-dark-400",children:[e.jsx(J,{className:"w-4 h-4"}),"€",t.hourly_rate.toFixed(2),"/ora"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>y(t),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(K,{className:"w-4 h-4 text-dark-400"})}),e.jsx("button",{onClick:()=>W(t.id),className:"p-2 hover:bg-red-500/20 rounded-lg transition-colors",children:e.jsx(G,{className:"w-4 h-4 text-red-400"})})]})]}),!t.active&&e.jsx("span",{className:"badge-danger mt-2",children:"Inattivo"})]},t.id))})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Turni Settimanali"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>N(-1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsxs("span",{className:"text-sm text-dark-300",children:[new Date(o[0]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})," - ",new Date(o[6]).toLocaleDateString("it-IT",{day:"numeric",month:"short"})]}),e.jsx("button",{onClick:()=>N(1),className:"p-2 hover:bg-dark-700 rounded-lg transition-colors",children:e.jsx(Z,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-semibold text-dark-300 uppercase tracking-wider bg-dark-900 sticky left-0",children:"Dipendente"}),o.map((t,l)=>e.jsxs("th",{className:"px-4 py-3 text-center text-xs font-semibold text-dark-300 uppercase tracking-wider bg-dark-900",children:[e.jsx("div",{children:A[l]}),e.jsx("div",{className:"text-dark-500 font-normal",children:new Date(t).getDate()})]},t))]})}),e.jsx("tbody",{children:h.filter(t=>t.active).map(t=>e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsxs("td",{className:"px-4 py-3 sticky left-0 bg-dark-800",children:[e.jsx("p",{className:"font-medium text-white",children:t.name}),e.jsx("p",{className:"text-xs text-dark-400",children:t.role})]}),o.map(l=>{const r=P(t.id,l);return e.jsx("td",{className:"px-2 py-2 text-center",children:r?e.jsxs("div",{className:`p-2 rounded-lg text-xs ${r.shift_type==="worked"?"bg-emerald-500/20 text-emerald-400":r.shift_type==="sick"?"bg-red-500/20 text-red-400":r.shift_type==="vacation"?"bg-blue-500/20 text-blue-400":"bg-amber-500/20 text-amber-400"}`,children:[e.jsxs("div",{className:"font-medium",children:[r.start_time," - ",r.end_time]}),e.jsxs("div",{className:"text-[10px] opacity-75",children:[r.hours_worked,"h"]})]}):e.jsx("button",{onClick:()=>b(t.id,l),className:"w-full p-2 rounded-lg border-2 border-dashed border-dark-600 hover:border-primary-500 hover:bg-dark-700 transition-colors text-dark-500 hover:text-primary-400",children:e.jsx(_,{className:"w-4 h-4 mx-auto"})})},l)})]},t.id))})]})})]}),e.jsx(w,{isOpen:F,onClose:()=>x(!1),title:p?"Modifica Dipendente":"Nuovo Dipendente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome *"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>c({...a,name:t.target.value}),className:"input",placeholder:"Nome completo"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Ruolo *"}),e.jsx("input",{type:"text",value:a.role,onChange:t=>c({...a,role:t.target.value}),className:"input",placeholder:"Es. Cuoco"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tariffa Oraria (€)"}),e.jsx("input",{type:"number",step:"0.01",value:a.hourly_rate,onChange:t=>c({...a,hourly_rate:t.target.value}),className:"input",placeholder:"10.00"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Telefono"}),e.jsx("input",{type:"tel",value:a.phone,onChange:t=>c({...a,phone:t.target.value}),className:"input",placeholder:"+39..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:t=>c({...a,email:t.target.value}),className:"input",placeholder:"email@esempio.com"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-white",children:"Attivo"}),e.jsx("button",{type:"button",onClick:()=>c({...a,active:!a.active}),className:`relative w-14 h-8 rounded-full transition-colors ${a.active?"bg-emerald-500":"bg-dark-600"}`,children:e.jsx("span",{className:`absolute top-1 w-6 h-6 bg-white rounded-full transition-transform ${a.active?"left-7":"left-1"}`})})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:L,className:"btn-primary flex-1",children:p?"Salva":"Aggiungi"}),e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(w,{isOpen:z,onClose:()=>u(!1),title:"Nuovo Turno",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Dipendente *"}),e.jsx("select",{value:s.employee_id,onChange:t=>d({...s,employee_id:parseInt(t.target.value)}),className:"select",children:h.filter(t=>t.active).map(t=>e.jsxs("option",{value:t.id,children:[t.name," - ",t.role]},t.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data *"}),e.jsx("input",{type:"date",value:s.date,onChange:t=>d({...s,date:t.target.value}),className:"input"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Inizio"}),e.jsx("input",{type:"time",value:s.start_time,onChange:t=>d({...s,start_time:t.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fine"}),e.jsx("input",{type:"time",value:s.end_time,onChange:t=>d({...s,end_time:t.target.value}),className:"input"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Tipo Turno"}),e.jsxs("select",{value:s.shift_type,onChange:t=>d({...s,shift_type:t.target.value}),className:"select",children:[e.jsx("option",{value:"worked",children:"Lavorativo"}),e.jsx("option",{value:"vacation",children:"Ferie"}),e.jsx("option",{value:"sick",children:"Malattia"}),e.jsx("option",{value:"other",children:"Altro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("textarea",{value:s.notes,onChange:t=>d({...s,notes:t.target.value}),className:"input resize-none h-20",placeholder:"Note opzionali..."})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:O,className:"btn-primary flex-1",children:"Salva Turno"}),e.jsx("button",{onClick:()=>u(!1),className:"btn-secondary",children:"Annulla"})]})]})})]})}export{ie as Staff};
