import{d as v,r,ax as z,ay as $,s as P,j as e,R as U,C as u,T,V as A}from"./index-CkC1_jyi.js";import{M as F}from"./Modal-BAfP4u6K.js";import{T as b}from"./trending-up-UZo6sk9e.js";import{T as y}from"./trending-down-C1jsscNN.js";import{S as V}from"./search-BcfGKHeA.js";import{E as I}from"./eye-KJrs00em.js";import{D as q}from"./dollar-sign-BLhAQU7I.js";const B=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],o=v("arrow-up-down",B);const L=[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]],O=v("percent",L);function Y(){const[k,m]=r.useState(!0),[w,_]=r.useState([]),[t,C]=r.useState(null),[h,M]=r.useState(""),[i,D]=r.useState("margin"),[p,g]=r.useState("desc"),[a,S]=r.useState(null),[E,j]=r.useState(!1);r.useEffect(()=>{N()},[]);async function N(){m(!0);try{const[s,l]=await Promise.all([z(),$()]);_(s),C(l)}catch(s){console.error("Error loading dish costs:",s),P("Errore nel caricamento costi","error")}finally{m(!1)}}const f=w.filter(s=>s.menu_item_name.toLowerCase().includes(h.toLowerCase())).sort((s,l)=>{let n=0;switch(i){case"name":n=s.menu_item_name.localeCompare(l.menu_item_name);break;case"margin":n=s.profit_margin_percent-l.profit_margin_percent;break;case"cost":n=s.ingredient_cost-l.ingredient_cost;break}return p==="asc"?n:-n});function d(s){return s>=70?"text-emerald-400":s>=50?"text-primary-400":s>=30?"text-amber-400":"text-red-400"}function c(s){return s>=70?"bg-emerald-500/20":s>=50?"bg-primary-500/20":s>=30?"bg-amber-500/20":"bg-red-500/20"}async function R(s){S(s),j(!0)}function x(s){i===s?g(p==="asc"?"desc":"asc"):(D(s),g("desc"))}return k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Costo Piatti"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Analisi costi e margini di profitto"})]}),e.jsxs("button",{onClick:N,className:"btn-secondary",children:[e.jsx(U,{className:"w-5 h-5"}),"Aggiorna"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Piatti Totali"}),e.jsx("p",{className:"stat-value",children:t?.totalDishes||0})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(u,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card glow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Margine Medio"}),e.jsxs("p",{className:`stat-value ${d(t?.avgProfitMargin||0)}`,children:[t?.avgProfitMargin||0,"%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-primary-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Alto Margine (>60%)"}),e.jsx("p",{className:"stat-value text-emerald-400",children:t?.highMarginDishes.length||0})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(b,{className:"w-6 h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Basso Margine (<40%)"}),e.jsx("p",{className:"stat-value text-red-400",children:t?.lowMarginDishes.length||0})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-red-400"})})]})})]}),t&&t.dishesWithoutRecipe.length>0&&e.jsx("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(T,{className:"w-5 h-5 text-amber-400 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-amber-400",children:"Piatti senza ricetta"}),e.jsx("p",{className:"text-sm text-dark-300 mt-1",children:"I seguenti piatti non hanno ingredienti associati, quindi il costo non può essere calcolato:"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:t.dishesWithoutRecipe.map(s=>e.jsx("span",{className:"px-2 py-1 bg-dark-700 rounded text-sm text-dark-300",children:s.name},s.id))}),e.jsx("p",{className:"text-xs text-dark-500 mt-2",children:"Vai alla sezione Ricette per associare gli ingredienti."})]})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-dark-500"}),e.jsx("input",{type:"text",value:h,onChange:s=>M(s.target.value),placeholder:"Cerca piatto...",className:"input pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>x("name"),className:`px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 ${i==="name"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Nome",i==="name"&&e.jsx(o,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>x("margin"),className:`px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 ${i==="margin"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Margine",i==="margin"&&e.jsx(o,{className:"w-4 h-4"})]}),e.jsxs("button",{onClick:()=>x("cost"),className:`px-3 py-2 rounded-lg text-sm transition-colors flex items-center gap-1 ${i==="cost"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300 hover:bg-dark-600"}`,children:["Costo",i==="cost"&&e.jsx(o,{className:"w-4 h-4"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5"}),"Analisi Costi (",f.length," piatti)"]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-3 px-4 text-dark-400 font-medium",children:"Piatto"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Prezzo"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Costo"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Profitto"}),e.jsx("th",{className:"text-right py-3 px-4 text-dark-400 font-medium",children:"Margine"}),e.jsx("th",{className:"text-center py-3 px-4 text-dark-400 font-medium",children:"Azioni"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-800",children:f.map(s=>e.jsxs("tr",{className:"hover:bg-dark-900/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg ${c(s.profit_margin_percent)} flex items-center justify-center`,children:e.jsx(u,{className:`w-5 h-5 ${d(s.profit_margin_percent)}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.menu_item_name}),e.jsxs("p",{className:"text-xs text-dark-500",children:[s.ingredients.length," ingredienti"]})]})]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"font-semibold text-white",children:[s.selling_price.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:"text-dark-300",children:[s.ingredient_cost.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:`font-semibold ${s.profit_margin>=0?"text-emerald-400":"text-red-400"}`,children:[s.profit_margin.toFixed(2)," EUR"]})}),e.jsx("td",{className:"py-3 px-4 text-right",children:e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-1 rounded-full text-sm font-semibold ${c(s.profit_margin_percent)} ${d(s.profit_margin_percent)}`,children:[s.profit_margin_percent,"%"]})}),e.jsx("td",{className:"py-3 px-4 text-center",children:e.jsx("button",{onClick:()=>R(s),className:"p-2 bg-dark-700 rounded-lg hover:bg-dark-600 transition-colors",title:"Vedi dettaglio",children:e.jsx(I,{className:"w-4 h-4 text-dark-300"})})})]},s.menu_item_id))})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(b,{className:"w-5 h-5 text-emerald-400"}),"Migliori Margini"]})}),e.jsxs("div",{className:"divide-y divide-dark-700",children:[t?.highMarginDishes.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"font-bold text-emerald-400",children:[s.profit_margin_percent,"%"]})]},s.menu_item_id)),(!t?.highMarginDishes||t.highMarginDishes.length===0)&&e.jsx("p",{className:"p-4 text-center text-dark-400",children:"Nessun piatto con margine >60%"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h3",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5 text-red-400"}),"Da Migliorare"]})}),e.jsxs("div",{className:"divide-y divide-dark-700",children:[t?.lowMarginDishes.slice(0,5).map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3",children:[e.jsx("span",{className:"text-white",children:s.menu_item_name}),e.jsxs("span",{className:"font-bold text-red-400",children:[s.profit_margin_percent,"%"]})]},s.menu_item_id)),(!t?.lowMarginDishes||t.lowMarginDishes.length===0)&&e.jsx("p",{className:"p-4 text-center text-dark-400",children:"Nessun piatto con margine <40%"})]})]})]}),e.jsx(F,{isOpen:E,onClose:()=>j(!1),title:`Dettaglio: ${a?.menu_item_name}`,size:"lg",children:a&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Prezzo Vendita"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[a.selling_price.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Costo Ingredienti"}),e.jsxs("p",{className:"text-xl font-bold text-amber-400",children:[a.ingredient_cost.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 text-center",children:[e.jsx("p",{className:"text-dark-400 text-sm",children:"Profitto"}),e.jsxs("p",{className:`text-xl font-bold ${a.profit_margin>=0?"text-emerald-400":"text-red-400"}`,children:[a.profit_margin.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:`${c(a.profit_margin_percent)} rounded-xl p-4 text-center`,children:[e.jsx("p",{className:"text-dark-300 text-sm",children:"Margine"}),e.jsxs("p",{className:`text-xl font-bold ${d(a.profit_margin_percent)}`,children:[a.profit_margin_percent,"%"]})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-white mb-3 flex items-center gap-2",children:[e.jsx(q,{className:"w-5 h-5"}),"Dettaglio Ingredienti"]}),e.jsx("div",{className:"bg-dark-800 rounded-xl overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-dark-700",children:[e.jsx("th",{className:"text-left py-2 px-4 text-dark-400 text-sm",children:"Ingrediente"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Quantità"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Costo/Unità"}),e.jsx("th",{className:"text-right py-2 px-4 text-dark-400 text-sm",children:"Totale"})]})}),e.jsx("tbody",{className:"divide-y divide-dark-700",children:a.ingredients.map(s=>e.jsxs("tr",{children:[e.jsx("td",{className:"py-2 px-4 text-white",children:s.ingredient_name}),e.jsxs("td",{className:"py-2 px-4 text-right text-dark-300",children:[s.quantity," ",s.unit]}),e.jsxs("td",{className:"py-2 px-4 text-right text-dark-300",children:[s.unit_cost.toFixed(2)," EUR/",s.unit]}),e.jsxs("td",{className:"py-2 px-4 text-right font-semibold text-amber-400",children:[s.total_cost.toFixed(2)," EUR"]})]},s.ingredient_id))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t border-dark-600 bg-dark-900/50",children:[e.jsx("td",{colSpan:3,className:"py-2 px-4 text-right font-semibold text-white",children:"Costo Totale:"}),e.jsxs("td",{className:"py-2 px-4 text-right font-bold text-primary-400",children:[a.ingredient_cost.toFixed(2)," EUR"]})]})})]})})]}),a.profit_margin_percent<40&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-amber-400 mb-2",children:"Suggerimenti"}),e.jsxs("ul",{className:"text-sm text-dark-300 space-y-1",children:[e.jsx("li",{children:"• Considera di aumentare il prezzo di vendita"}),e.jsx("li",{children:"• Cerca fornitori con costi più bassi per gli ingredienti principali"}),e.jsx("li",{children:"• Valuta porzioni più piccole mantenendo il prezzo"}),e.jsx("li",{children:"• Sostituisci ingredienti costosi con alternative più economiche"})]})]}),a.profit_margin_percent>=70&&e.jsxs("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-4",children:[e.jsx("h4",{className:"font-semibold text-emerald-400 mb-2",children:"Ottimo margine!"}),e.jsx("p",{className:"text-sm text-dark-300",children:"Questo piatto ha un margine eccellente. Considera di promuoverlo di più o usarlo come base per varianti simili."})]})]})})]})}export{Y as DishCosts};
