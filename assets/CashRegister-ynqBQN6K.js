import{d as E,r,aL as q,aM as B,z as G,s as d,j as e,aN as k,c as S,ab as Q,f as W,aO as X,V as R,aP as J,aQ as K}from"./index-B0wSphca.js";import{M as u}from"./Modal-BWrzqEB0.js";import{C as Y}from"./calendar-DlRTZ7zX.js";import{B as Z}from"./banknote-dOFNUFHq.js";import{S as ee}from"./smartphone-BpQ1Ht5p.js";import{F as se}from"./file-text-VXTMgDYd.js";import{T as ae}from"./trending-up-_aKdDglj.js";import{T as te}from"./trending-down-C4iCijFv.js";const le=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]],re=E("history",le);const ne=[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]],ie=E("printer",ne);function ue(){const[n,F]=r.useState(new Date().toISOString().split("T")[0]),[U,N]=r.useState(!0),[a,T]=r.useState(null),[m,D]=r.useState([]),[h,M]=r.useState([]),[O,o]=r.useState(!1),[z,f]=r.useState(!1),[A,v]=r.useState(!1),[t,I]=r.useState(null),[i,b]=r.useState(""),[c,y]=r.useState(""),[g,w]=r.useState(""),p=r.useRef(null);r.useEffect(()=>{C()},[n]);async function C(){N(!0);try{const[s,l,x]=await Promise.all([q(n),B(),G(n)]);T(s),D(l),M(x.filter(j=>j.status!=="cancelled"))}catch(s){console.error("Error loading data:",s),d("Errore nel caricamento dati","error")}finally{N(!1)}}const _=m.some(s=>s.date===n);async function L(){if(!i||!c){d("Inserisci fondo cassa iniziale e finale","error");return}const s=parseFloat(i),l=parseFloat(c),x=s+(a?.cash_revenue||0),j=l-x;try{await K({date:n,opening_cash:s,closing_cash:l,expected_cash:x,difference:j,total_orders:a?.total_orders||0,total_revenue:a?.total_revenue||0,cash_revenue:a?.cash_revenue||0,card_revenue:a?.card_revenue||0,online_revenue:a?.online_revenue||0,smac_total:a?.smac_total||0,non_smac_total:a?.non_smac_total||0,notes:g,closed_by:"Admin"}),d("Chiusura cassa salvata con successo","success"),o(!1),b(""),y(""),w(""),C()}catch($){console.error("Error saving closure:",$),d("Errore nel salvataggio","error")}}async function P(s){try{const l=await J(s);l&&(I(l),v(!0))}catch(l){console.error("Error generating receipt:",l),d("Errore nella generazione scontrino","error")}}function H(){if(p.current){const s=p.current.innerHTML,l=window.open("","_blank");l&&(l.document.write(`
          <html>
            <head>
              <title>Scontrino</title>
              <style>
                body { font-family: 'Courier New', monospace; padding: 20px; max-width: 300px; margin: 0 auto; }
                .header { text-align: center; margin-bottom: 20px; }
                .shop-name { font-size: 18px; font-weight: bold; }
                .divider { border-top: 1px dashed #000; margin: 10px 0; }
                .item { display: flex; justify-content: space-between; margin: 5px 0; }
                .total { font-weight: bold; font-size: 16px; }
                .footer { text-align: center; margin-top: 20px; font-size: 12px; }
              </style>
            </head>
            <body>${s}</body>
          </html>
        `),l.document.close(),l.print())}}const V=s=>new Date(s).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return U?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Chiusura Cassa"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Riepilogo giornaliero e scontrini"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>f(!0),className:"btn-secondary",children:[e.jsx(re,{className:"w-5 h-5"}),"Storico"]}),!_&&a&&a.total_orders>0&&e.jsxs("button",{onClick:()=>o(!0),className:"btn-primary",children:[e.jsx(k,{className:"w-5 h-5"}),"Chiudi Cassa"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Y,{className:"w-5 h-5 text-dark-400"}),e.jsx("input",{type:"date",value:n,onChange:s=>F(s.target.value),className:"input w-auto"}),e.jsx("span",{className:"text-dark-400",children:V(n)}),_&&e.jsxs("span",{className:"px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded-full text-sm flex items-center gap-1",children:[e.jsx(S,{className:"w-4 h-4"}),"Cassa Chiusa"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card glow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Incasso Totale"}),e.jsxs("p",{className:"stat-value text-primary-400",children:[a?.total_revenue.toFixed(2)," EUR"]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:[a?.total_orders," ordini"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-primary-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Contanti"}),e.jsxs("p",{className:"stat-value text-emerald-400",children:[a?.cash_revenue.toFixed(2)," EUR"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(Z,{className:"w-6 h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Carta"}),e.jsxs("p",{className:"stat-value text-blue-400",children:[a?.card_revenue.toFixed(2)," EUR"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Online"}),e.jsxs("p",{className:"stat-value text-purple-400",children:[a?.online_revenue.toFixed(2)," EUR"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center",children:e.jsx(ee,{className:"w-6 h-6 text-purple-400"})})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(S,{className:"w-5 h-5 text-emerald-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"SMAC Passata"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-400",children:[a?.smac_total.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(X,{className:"w-5 h-5 text-amber-400"}),e.jsx("h3",{className:"font-semibold text-white",children:"SMAC Non Passata"})]}),e.jsxs("p",{className:"text-2xl font-bold text-amber-400",children:[a?.non_smac_total.toFixed(2)," EUR"]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white",children:"Ordini per Tipologia"})}),e.jsxs("div",{className:"p-4 grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-dark-800 rounded-xl",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:a?.orders_by_type.dine_in||0}),e.jsx("p",{className:"text-dark-400 text-sm",children:"In Sala"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-800 rounded-xl",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:a?.orders_by_type.takeaway||0}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Asporto"})]}),e.jsxs("div",{className:"text-center p-4 bg-dark-800 rounded-xl",children:[e.jsx("p",{className:"text-3xl font-bold text-white",children:a?.orders_by_type.delivery||0}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Domicilio"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Ordini del Giorno (",h.length,")"]})}),e.jsx("div",{className:"divide-y divide-dark-700 max-h-96 overflow-y-auto",children:h.length===0?e.jsxs("div",{className:"p-8 text-center text-dark-400",children:[e.jsx(se,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nessun ordine per questa data"})]}):h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-dark-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-dark-700 flex items-center justify-center",children:e.jsxs("span",{className:"text-sm font-bold text-primary-400",children:["#",s.id]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-white",children:[s.order_type==="dine_in"?"Tavolo":s.order_type==="takeaway"?"Asporto":"Domicilio",s.table_name&&` - ${s.table_name}`]}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online",s.smac_passed&&" â€¢ SMAC"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("p",{className:"text-lg font-bold text-primary-400",children:[s.total.toFixed(2)," EUR"]}),e.jsx("button",{onClick:()=>P(s.id),className:"p-2 bg-dark-700 rounded-lg hover:bg-dark-600 transition-colors",title:"Visualizza scontrino",children:e.jsx(R,{className:"w-5 h-5 text-dark-300"})})]})]},s.id))})]}),e.jsx(u,{isOpen:O,onClose:()=>o(!1),title:"Chiusura Cassa",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4 space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Incasso Totale:"}),e.jsxs("span",{className:"font-bold text-white",children:[a?.total_revenue.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Di cui Contanti:"}),e.jsxs("span",{className:"font-bold text-emerald-400",children:[a?.cash_revenue.toFixed(2)," EUR"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Fondo Cassa Iniziale (EUR)"}),e.jsx("input",{type:"number",step:"0.01",value:i,onChange:s=>b(s.target.value),className:"input",placeholder:"Es: 100.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Contanti in Cassa Finale (EUR)"}),e.jsx("input",{type:"number",step:"0.01",value:c,onChange:s=>y(s.target.value),className:"input",placeholder:"Es: 350.00"})]}),i&&c&&e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("span",{className:"text-dark-400",children:"Contanti Attesi:"}),e.jsxs("span",{className:"font-bold text-white",children:[(parseFloat(i)+(a?.cash_revenue||0)).toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-dark-400",children:"Differenza:"}),e.jsxs("span",{className:`font-bold ${parseFloat(c)-(parseFloat(i)+(a?.cash_revenue||0))>=0?"text-emerald-400":"text-red-400"}`,children:[(parseFloat(c)-(parseFloat(i)+(a?.cash_revenue||0))).toFixed(2)," EUR"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-2",children:"Note (opzionale)"}),e.jsx("textarea",{value:g,onChange:s=>w(s.target.value),className:"input",rows:3,placeholder:"Eventuali note sulla chiusura..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>o(!1),className:"btn-secondary flex-1",children:"Annulla"}),e.jsxs("button",{onClick:L,className:"btn-primary flex-1",children:[e.jsx(k,{className:"w-5 h-5"}),"Conferma Chiusura"]})]})]})}),e.jsx(u,{isOpen:z,onClose:()=>f(!1),title:"Storico Chiusure Cassa",size:"lg",children:e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:m.length===0?e.jsx("p",{className:"text-center text-dark-400 py-8",children:"Nessuna chiusura registrata"}):m.slice(0,30).map(s=>e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"font-semibold text-white",children:new Date(s.date).toLocaleDateString("it-IT",{weekday:"short",day:"numeric",month:"short",year:"numeric"})}),e.jsxs("span",{className:`flex items-center gap-1 text-sm ${s.difference>=0?"text-emerald-400":"text-red-400"}`,children:[s.difference>=0?e.jsx(ae,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4"}),s.difference>=0?"+":"",s.difference.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-400",children:"Incasso:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.total_revenue.toFixed(2)," EUR"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-400",children:"Ordini:"}),e.jsx("span",{className:"text-white ml-2",children:s.total_orders})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-400",children:"Contanti:"}),e.jsxs("span",{className:"text-emerald-400 ml-2",children:[s.cash_revenue.toFixed(2)," EUR"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-dark-400",children:"Carta:"}),e.jsxs("span",{className:"text-blue-400 ml-2",children:[s.card_revenue.toFixed(2)," EUR"]})]})]}),s.notes&&e.jsxs("p",{className:"text-dark-500 text-sm mt-2 italic",children:['"',s.notes,'"']})]},s.id))})}),e.jsx(u,{isOpen:A,onClose:()=>v(!1),title:"Scontrino",children:t&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{ref:p,className:"bg-white text-black p-6 rounded-lg font-mono text-sm",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("p",{className:"font-bold text-lg",children:t.shop_info.name}),t.shop_info.address&&e.jsx("p",{className:"text-xs",children:t.shop_info.address}),t.shop_info.phone&&e.jsxs("p",{className:"text-xs",children:["Tel: ",t.shop_info.phone]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"text-xs mb-3",children:[e.jsxs("p",{children:["Scontrino: ",t.receipt_number]}),e.jsxs("p",{children:["Data: ",t.date," ",t.time]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("div",{className:"space-y-1",children:t.items.map((s,l)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[s.quantity,"x ",s.name]}),e.jsx("span",{children:s.total.toFixed(2)})]},l))}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Imponibile:"}),e.jsxs("span",{children:[t.subtotal.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["IVA (",t.iva_rate,"%):"]}),e.jsxs("span",{children:[t.iva_amount.toFixed(2)," EUR"]})]}),e.jsxs("div",{className:"flex justify-between font-bold text-base",children:[e.jsx("span",{children:"TOTALE:"}),e.jsxs("span",{children:[t.total.toFixed(2)," EUR"]})]})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsxs("div",{className:"text-xs text-center",children:[e.jsxs("p",{children:["Pagamento: ",t.payment_method==="cash"?"Contanti":t.payment_method==="card"?"Carta":"Online"]}),t.smac_passed&&e.jsx("p",{className:"font-bold",children:"SMAC REGISTRATA"})]}),e.jsx("div",{className:"border-t border-dashed border-gray-400 my-3"}),e.jsx("p",{className:"text-center text-xs",children:"Grazie e arrivederci!"})]}),e.jsxs("button",{onClick:H,className:"btn-primary w-full",children:[e.jsx(ie,{className:"w-5 h-5"}),"Stampa Scontrino"]})]})})]})}export{ue as CashRegister};
