import{d as Ne,r as a,K as be,b as ve,M as ye,N as fe,O as we,Q as ke,s as i,j as e,R as Se,P as Q,V as P,T as U,S as B,e as _e,X as Ce,Y as Fe,Z as Ie,_ as qe,$ as Ae,a0 as Ee}from"./index-CkC1_jyi.js";import{M as I}from"./Modal-BAfP4u6K.js";import{P as M}from"./plus-CGOSodOK.js";import{T as ze}from"./trending-down-C1jsscNN.js";import{P as Te}from"./pen-BrIsXUx_.js";import{E as Oe}from"./eye-KJrs00em.js";import{C as De}from"./clock-Cb5VLSEn.js";import{A as Qe}from"./arrow-right-23R_OKxw.js";const Me=[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]],f=Ne("truck",Me);function Ve(){const[q,G]=a.useState([]),[x,K]=a.useState([]),[$,V]=a.useState([]),[w,H]=a.useState([]),[k,X]=a.useState([]),[m,Y]=a.useState(null),[Z,J]=a.useState(!0),[h,A]=a.useState("inventory"),[E,R]=a.useState("all"),[W,S]=a.useState(!1),[ee,_]=a.useState(!1),[se,g]=a.useState(!1),[te,z]=a.useState(!1),[o,ae]=a.useState(null),[u,T]=a.useState(null),[ie,O]=a.useState([]),[r,C]=a.useState({name:"",unit:"kg",cost:""}),[N,L]=a.useState(""),[b,D]=a.useState("add"),[d,p]=a.useState({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:""}),[l,v]=a.useState([]),[n,F]=a.useState({ingredient_id:0,quantity:"",unit_cost:""});a.useEffect(()=>{j()},[]);async function j(){try{const[s,t,c,pe,je,ge]=await Promise.all([be(),ve(),ye(),fe(),we(),ke()]);G(s),K(t),V(c),H(pe),X(je),Y(ge)}catch(s){console.error("Error loading data:",s),i("Errore nel caricamento dati","error")}finally{J(!1)}}const y=$.filter(s=>s.days_until_reorder<7&&s.avg_daily_consumption>0),ne=E==="low"?x:q;function re(s){ae(s),L(""),D("add"),_(!0)}async function le(){if(!r.name.trim()){i("Inserisci un nome","warning");return}try{await qe({name:r.name.trim(),unit:r.unit,cost:parseFloat(r.cost)||0}),i("Ingrediente aggiunto","success"),S(!1),C({name:"",unit:"kg",cost:""}),j()}catch(s){console.error("Error adding ingredient:",s),i("Errore nell'aggiunta","error")}}async function de(){if(!o||!N){i("Inserisci una quantità","warning");return}try{const s=parseFloat(N),t=b==="add"?o.quantity+s:s;await Ae(o.ingredient_id,t),i("Quantità aggiornata","success"),_(!1),j()}catch(s){console.error("Error updating quantity:",s),i("Errore nell'aggiornamento","error")}}function ce(){if(!n.ingredient_id||!n.quantity||!n.unit_cost){i("Compila tutti i campi","warning");return}const s=w.find(t=>t.id===n.ingredient_id);if(s){if(l.some(t=>t.ingredient_id===n.ingredient_id)){i("Ingrediente già aggiunto","warning");return}v([...l,{ingredient_id:n.ingredient_id,ingredient_name:s.name,unit:s.unit,quantity:parseFloat(n.quantity),unit_cost:parseFloat(n.unit_cost)}]),F({ingredient_id:0,quantity:"",unit_cost:""})}}function oe(s){v(l.filter(t=>t.ingredient_id!==s))}async function xe(){if(l.length===0){i("Aggiungi almeno un ingrediente","warning");return}try{await Ee({date:d.date,supplier_name:d.supplier_name||void 0,notes:d.notes||void 0},l.map(s=>({ingredient_id:s.ingredient_id,quantity:s.quantity,unit_cost:s.unit_cost}))),i("Fornitura registrata con successo","success"),g(!1),p({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:""}),v([]),j()}catch(s){console.error("Error creating supply:",s),i("Errore nella creazione fornitura","error")}}async function me(s){try{const t=await Fe(s.id);T(s),O(t),z(!0)}catch(t){console.error("Error loading supply items:",t),i("Errore nel caricamento dettagli","error")}}async function he(s){if(confirm("Sei sicuro di voler eliminare questa fornitura? Le quantità non verranno restituite all'inventario."))try{await Ie(s),i("Fornitura eliminata","success"),j()}catch(t){console.error("Error deleting supply:",t),i("Errore nell'eliminazione","error")}}const ue=l.reduce((s,t)=>s+t.quantity*t.unit_cost,0);return Z?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Inventario"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Gestisci scorte e ottimizza riordini"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:j,className:"btn-secondary btn-sm",children:e.jsx(Se,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary btn-sm",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Nuova Fornitura"})]}),e.jsxs("button",{onClick:()=>S(!0),className:"btn-secondary btn-sm",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Ingrediente"})]})]})]}),e.jsxs("div",{className:"flex gap-2 border-b border-dark-700 pb-2 overflow-x-auto",children:[e.jsxs("button",{onClick:()=>A("inventory"),className:`px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap ${h==="inventory"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(Q,{className:"w-4 h-4 inline mr-2"}),"Scorte"]}),e.jsxs("button",{onClick:()=>A("supplies"),className:`px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap ${h==="supplies"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(f,{className:"w-4 h-4 inline mr-2"}),"Forniture",k.length>0&&e.jsx("span",{className:"ml-2 bg-blue-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:k.length})]}),e.jsxs("button",{onClick:()=>A("eoq"),className:`px-4 py-2 rounded-t-lg font-medium transition-all whitespace-nowrap ${h==="eoq"?"bg-dark-800 text-primary-400 border-b-2 border-primary-500":"text-dark-400 hover:text-white"}`,children:[e.jsx(P,{className:"w-4 h-4 inline mr-2"}),"EOQ & Riordini",y.length>0&&e.jsx("span",{className:"ml-2 bg-red-500 text-white text-xs px-1.5 py-0.5 rounded-full",children:y.length})]})]}),h==="inventory"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Totale Ingredienti"}),e.jsx("p",{className:"stat-value",children:q.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Scorte Basse"}),e.jsx("p",{className:"stat-value",children:x.length})]}),e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${x.length>0?"bg-red-500/20":"bg-emerald-500/20"}`,children:e.jsx(U,{className:`w-6 h-6 ${x.length>0?"text-red-400":"text-emerald-400"}`})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Da Riordinare (7gg)"}),e.jsx("p",{className:"stat-value",children:y.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(ze,{className:"w-6 h-6 text-amber-400"})})]})})]}),x.length>0&&e.jsx("div",{className:"bg-red-500/10 border border-red-500/30 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"w-6 h-6 text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-red-400",children:"Attenzione: Scorte Basse"}),e.jsx("p",{className:"text-sm text-dark-300",children:x.map(s=>s.ingredient_name).join(", ")})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>R("all"),className:`px-4 py-2 rounded-xl font-medium transition-all ${E==="all"?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Tutti (",q.length,")"]}),e.jsxs("button",{onClick:()=>R("low"),className:`px-4 py-2 rounded-xl font-medium transition-all ${E==="low"?"bg-red-500 text-white":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Scorte Basse (",x.length,")"]})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Quantità"}),e.jsx("th",{children:"Unità"}),e.jsx("th",{children:"Soglia"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:ne.map(s=>{const t=s.quantity<=s.threshold;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${t?"text-red-400":"text-white"}`,children:s.quantity.toFixed(2)})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.unit})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400",children:s.threshold})}),e.jsx("td",{children:e.jsx("span",{className:t?"badge-danger":"badge-success",children:t?"Basso":"OK"})}),e.jsx("td",{children:e.jsxs("button",{onClick:()=>re(s),className:"btn-secondary btn-sm",children:[e.jsx(Te,{className:"w-4 h-4"}),"Aggiorna"]})})]},s.id)})})]})})})]}),h==="supplies"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Totale Forniture"}),e.jsx("p",{className:"stat-value",children:m?.suppliesCount||0})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(f,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Speso Totale"}),e.jsxs("p",{className:"stat-value",children:[m?.totalSpent.toFixed(2)||"0.00"," €"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(B,{className:"w-6 h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Media Fornitura"}),e.jsxs("p",{className:"stat-value",children:[m?.avgSupplyCost.toFixed(2)||"0.00"," €"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Ingredienti"}),e.jsx("p",{className:"stat-value",children:w.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center",children:e.jsx(Q,{className:"w-6 h-6 text-purple-400"})})]})})]}),m&&m.topIngredients.length>0&&e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white",children:"Top Ingredienti Acquistati"})}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-3",children:m.topIngredients.map((s,t)=>e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-white text-sm truncate",children:s.ingredient_name}),e.jsxs("p",{className:"text-primary-400 font-semibold",children:[s.total_cost.toFixed(2)," €"]}),e.jsxs("p",{className:"text-dark-400 text-xs",children:["Qty: ",s.quantity.toFixed(2)]})]},t))})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsx("h2",{className:"font-semibold text-white",children:"Storico Forniture"}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary btn-sm",children:[e.jsx(M,{className:"w-4 h-4"}),"Nuova Fornitura"]})]}),k.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(f,{className:"w-12 h-12 text-dark-500 mx-auto mb-3"}),e.jsx("p",{className:"text-dark-400",children:"Nessuna fornitura registrata"}),e.jsx("p",{className:"text-dark-500 text-sm mt-1",children:'Clicca su "Nuova Fornitura" per registrare la prima'})]}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Data"}),e.jsx("th",{children:"Fornitore"}),e.jsx("th",{children:"Totale"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:k.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:new Date(s.date).toLocaleDateString("it-IT",{day:"2-digit",month:"short",year:"numeric"})})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-300",children:s.supplier_name||"-"})}),e.jsx("td",{children:e.jsxs("p",{className:"font-semibold text-primary-400",children:[s.total_cost.toFixed(2)," €"]})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400 text-sm truncate max-w-[200px]",children:s.notes||"-"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>me(s),className:"btn-secondary btn-sm",title:"Visualizza dettagli",children:e.jsx(Oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>he(s.id),className:"btn-danger btn-sm",title:"Elimina",children:e.jsx(_e,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),h==="eoq"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2",children:"Cos'è l'EOQ?"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["L'",e.jsx("strong",{children:"Economic Order Quantity"})," (EOQ) è la quantità ottimale da ordinare che minimizza i costi totali (costo ordine + costo stoccaggio). Il sistema analizza i consumi storici per calcolare automaticamente quando e quanto riordinare."]})]}),y.length>0&&e.jsxs("div",{className:"bg-amber-500/10 border border-amber-500/30 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(B,{className:"w-5 h-5 text-amber-400"}),e.jsx("h3",{className:"font-semibold text-amber-400",children:"Da riordinare nei prossimi 7 giorni"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:y.map(s=>e.jsxs("div",{className:"bg-dark-800 rounded-lg p-3",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1 text-sm",children:[e.jsx(De,{className:"w-3 h-3 text-amber-400"}),e.jsx("span",{className:"text-amber-400",children:s.days_until_reorder===0?"Oggi!":`${s.days_until_reorder} giorni`})]}),e.jsxs("div",{className:"flex items-center gap-1 mt-2 text-xs text-dark-400",children:[e.jsxs("span",{children:["Ordina: ",s.eoq.toFixed(1)]}),e.jsx(Qe,{className:"w-3 h-3"}),e.jsx("span",{className:"text-emerald-400",children:"Risparmio ottimale"})]})]},s.ingredient_id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h2",{className:"font-semibold text-white",children:"Analisi EOQ Ingredienti"})}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingrediente"}),e.jsx("th",{children:"Stock Attuale"}),e.jsx("th",{children:"Consumo/Giorno"}),e.jsx("th",{children:"EOQ"}),e.jsx("th",{children:"Punto Riordino"}),e.jsx("th",{children:"Giorni al Riordino"}),e.jsx("th",{children:"Ordini/Anno"})]})}),e.jsx("tbody",{children:$.map(s=>{const t=s.days_until_reorder<7&&s.avg_daily_consumption>0,c=s.avg_daily_consumption===0;return e.jsxs("tr",{className:t?"bg-amber-500/10":"",children:[e.jsx("td",{children:e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name})}),e.jsx("td",{children:e.jsx("p",{className:`font-semibold ${s.current_stock<=s.reorder_point?"text-red-400":"text-white"}`,children:s.current_stock.toFixed(2)})}),e.jsx("td",{children:c?e.jsx("span",{className:"text-dark-500 text-sm",children:"Nessun dato"}):e.jsx("p",{className:"text-dark-300",children:s.avg_daily_consumption.toFixed(3)})}),e.jsx("td",{children:c?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-primary-400 font-semibold",children:s.eoq.toFixed(1)})}),e.jsx("td",{children:c?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-300",children:s.reorder_point.toFixed(1)})}),e.jsx("td",{children:c?e.jsx("span",{className:"text-dark-500",children:"-"}):s.days_until_reorder===1/0?e.jsx("span",{className:"badge-success",children:"OK"}):e.jsxs("span",{className:`font-semibold ${s.days_until_reorder<3?"text-red-400":s.days_until_reorder<7?"text-amber-400":"text-emerald-400"}`,children:[s.days_until_reorder," gg"]})}),e.jsx("td",{children:c?e.jsx("span",{className:"text-dark-500",children:"-"}):e.jsx("p",{className:"text-dark-400",children:s.order_frequency.toFixed(1)})})]},s.ingredient_id)})})]})})]}),e.jsxs("div",{className:"bg-dark-800 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Legenda"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"EOQ"}),": Quantità ottimale da ordinare"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Punto Riordino"}),": Stock al quale effettuare l'ordine"]})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Scorta Sicurezza"}),": Buffer per evitare stockout"]}),e.jsxs("p",{className:"text-dark-400",children:[e.jsx("strong",{className:"text-white",children:"Ordini/Anno"}),": Frequenza ordini stimata"]})]})]}),e.jsx("p",{className:"text-xs text-dark-500 mt-3",children:"* I calcoli si basano sui consumi degli ultimi 30 giorni. Più ordini elabori, più precisi saranno i dati."})]})]}),e.jsx(I,{isOpen:W,onClose:()=>S(!1),title:"Aggiungi Ingrediente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Nome Ingrediente *"}),e.jsx("input",{type:"text",value:r.name,onChange:s=>C({...r,name:s.target.value}),className:"input",placeholder:"Es. Carne Kebab"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Unità di Misura"}),e.jsxs("select",{value:r.unit,onChange:s=>C({...r,unit:s.target.value}),className:"select",children:[e.jsx("option",{value:"kg",children:"Chilogrammi (kg)"}),e.jsx("option",{value:"g",children:"Grammi (g)"}),e.jsx("option",{value:"lt",children:"Litri (lt)"}),e.jsx("option",{value:"ml",children:"Millilitri (ml)"}),e.jsx("option",{value:"pz",children:"Pezzi (pz)"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Costo Unitario (€)"}),e.jsx("input",{type:"number",step:"0.01",value:r.cost,onChange:s=>C({...r,cost:s.target.value}),className:"input",placeholder:"0.00"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:le,className:"btn-primary flex-1",children:"Aggiungi"}),e.jsx("button",{onClick:()=>S(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(I,{isOpen:ee,onClose:()=>_(!1),title:`Aggiorna ${o?.ingredient_name}`,size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4",children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Quantità attuale"}),e.jsxs("p",{className:"text-2xl font-bold text-white",children:[o?.quantity.toFixed(2)," ",o?.unit]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Modalità"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx("button",{onClick:()=>D("add"),className:`py-2 rounded-xl font-medium transition-all ${b==="add"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Aggiungi"}),e.jsx("button",{onClick:()=>D("set"),className:`py-2 rounded-xl font-medium transition-all ${b==="set"?"bg-primary-500 text-dark-900":"bg-dark-700 text-dark-300"}`,children:"Imposta"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:b==="add"?"Quantità da aggiungere":"Nuova quantità"}),e.jsx("input",{type:"number",step:"0.01",value:N,onChange:s=>L(s.target.value),className:"input",placeholder:"0.00"})]}),b==="add"&&N&&e.jsx("div",{className:"bg-emerald-500/10 border border-emerald-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-emerald-400",children:["Nuova quantità: ",((o?.quantity||0)+parseFloat(N||"0")).toFixed(2)," ",o?.unit]})}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[e.jsx("button",{onClick:de,className:"btn-primary flex-1",children:"Aggiorna"}),e.jsx("button",{onClick:()=>_(!1),className:"btn-secondary",children:"Annulla"})]})]})}),e.jsx(I,{isOpen:se,onClose:()=>{g(!1),v([]),p({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:""})},title:"Nuova Fornitura",size:"lg",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Data Fornitura *"}),e.jsx("input",{type:"date",value:d.date,onChange:s=>p({...d,date:s.target.value}),className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Fornitore"}),e.jsx("input",{type:"text",value:d.supplier_name,onChange:s=>p({...d,supplier_name:s.target.value}),className:"input",placeholder:"Es. Fornitore S.r.l."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Note"}),e.jsx("input",{type:"text",value:d.notes,onChange:s=>p({...d,notes:s.target.value}),className:"input",placeholder:"Note opzionali sulla fornitura"})]}),e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Aggiungi Ingrediente"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"label",children:"Ingrediente"}),e.jsxs("select",{value:n.ingredient_id,onChange:s=>{const t=w.find(c=>c.id===Number(s.target.value));F({...n,ingredient_id:Number(s.target.value),unit_cost:t?.cost?.toString()||""})},className:"select",children:[e.jsx("option",{value:0,children:"Seleziona ingrediente..."}),w.filter(s=>!l.some(t=>t.ingredient_id===s.id)).map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.unit,")"]},s.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Quantità"}),e.jsx("input",{type:"number",step:"0.01",value:n.quantity,onChange:s=>F({...n,quantity:s.target.value}),className:"input",placeholder:"0.00"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"label",children:"Costo Unit. (€)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"number",step:"0.01",value:n.unit_cost,onChange:s=>F({...n,unit_cost:s.target.value}),className:"input flex-1",placeholder:"0.00"}),e.jsx("button",{onClick:ce,className:"btn-primary px-3",title:"Aggiungi",children:e.jsx(M,{className:"w-5 h-5"})})]})]})]})]}),l.length>0&&e.jsxs("div",{className:"border-t border-dark-700 pt-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Ingredienti nella Fornitura"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:l.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit," x ",s.unit_cost.toFixed(2)," €"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("p",{className:"font-semibold text-primary-400",children:[(s.quantity*s.unit_cost).toFixed(2)," €"]}),e.jsx("button",{onClick:()=>oe(s.ingredient_id),className:"text-red-400 hover:text-red-300 p-1",children:e.jsx(Ce,{className:"w-5 h-5"})})]})]},s.ingredient_id))}),e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white",children:"Totale Fornitura"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[ue.toFixed(2)," €"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t border-dark-700",children:[e.jsxs("button",{onClick:xe,disabled:l.length===0,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsx(f,{className:"w-4 h-4"}),"Registra Fornitura"]}),e.jsx("button",{onClick:()=>{g(!1),v([]),p({date:new Date().toISOString().split("T")[0],supplier_name:"",notes:""})},className:"btn-secondary",children:"Annulla"})]}),e.jsx("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-3",children:e.jsxs("p",{className:"text-sm text-blue-400",children:[e.jsx("strong",{children:"Nota:"})," Quando registri una fornitura, le quantità vengono automaticamente aggiunte all'inventario e i costi degli ingredienti vengono aggiornati."]})})]})}),e.jsx(I,{isOpen:te,onClose:()=>{z(!1),T(null),O([])},title:"Dettaglio Fornitura",size:"md",children:u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Data"}),e.jsx("p",{className:"font-semibold text-white",children:new Date(u.date).toLocaleDateString("it-IT",{day:"2-digit",month:"long",year:"numeric"})})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Fornitore"}),e.jsx("p",{className:"font-semibold text-white",children:u.supplier_name||"Non specificato"})]})]}),u.notes&&e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsx("p",{className:"text-xs text-dark-400 uppercase",children:"Note"}),e.jsx("p",{className:"text-white",children:u.notes})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Articoli"}),e.jsx("div",{className:"space-y-2",children:ie.map(s=>e.jsxs("div",{className:"flex items-center justify-between bg-dark-900 rounded-lg px-4 py-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.ingredient_name}),e.jsxs("p",{className:"text-sm text-dark-400",children:[s.quantity," ",s.unit," x ",s.unit_cost.toFixed(2)," €/",s.unit]})]}),e.jsxs("p",{className:"font-semibold text-primary-400",children:[(s.total_cost||s.quantity*s.unit_cost).toFixed(2)," €"]})]},s.id))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-700",children:[e.jsx("p",{className:"font-semibold text-white text-lg",children:"Totale"}),e.jsxs("p",{className:"text-2xl font-bold text-primary-400",children:[u.total_cost.toFixed(2)," €"]})]}),e.jsx("div",{className:"pt-4 border-t border-dark-700",children:e.jsx("button",{onClick:()=>{z(!1),T(null),O([])},className:"btn-secondary w-full",children:"Chiudi"})})]})})]})}export{Ve as Inventory};
