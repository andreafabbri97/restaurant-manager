import{r as n,o as z,s as i,p as b,q as x,j as e,W as A,t as q,R as B,L as $,e as y,P as M,c as j,C as W,v as Q,w as G,x as H}from"./index-tmRa7dq2.js";import{M as U}from"./Modal-MWrXhYEf.js";import{P as J}from"./plus-BAVCWZw2.js";import{S as K}from"./search-B4gV-ndK.js";import{C as V}from"./clock-MogUA_ly.js";import{E as X}from"./eye-PzIgOMys.js";const d={pending:{label:"In Attesa",icon:V,color:"badge-warning",next:"preparing"},preparing:{label:"In Preparazione",icon:W,color:"badge-info",next:"ready"},ready:{label:"Pronto",icon:j,color:"badge-success",next:"delivered"},delivered:{label:"Consegnato",icon:M,color:"badge-success",next:null},cancelled:{label:"Annullato",icon:y,color:"badge-danger",next:null}},v={dine_in:"Tavolo",takeaway:"Asporto",delivery:"Domicilio"};function re(){const[w,C]=n.useState([]),[k,g]=n.useState(!0),[h,S]=n.useState(new Date().toISOString().split("T")[0]),[p,O]=n.useState("all"),[u,_]=n.useState(""),[a,E]=n.useState(null),[P,D]=n.useState([]),[I,o]=n.useState(!1),[f,T]=n.useState(!1),l=n.useCallback(async()=>{g(!0);try{const s=await z(h);C(s)}catch(s){console.error("Error loading orders:",s),i("Errore nel caricamento ordini","error")}finally{g(!1)}},[h]);n.useEffect(()=>{l()},[l]),n.useEffect(()=>{if(!b||!x)return;const s=x.channel("orders-realtime").on("postgres_changes",{event:"*",schema:"public",table:"orders"},t=>{console.log("Realtime update:",t),l()}).subscribe(t=>{console.log("Realtime status:",t),T(t==="SUBSCRIBED")});return()=>{x&&x.removeChannel(s)}},[l]);async function N(s){const t=d[s.status];if(t.next)try{await G(s.id,t.next),i(`Ordine #${s.id} aggiornato`,"success"),l()}catch(c){console.error("Error updating order:",c),i("Errore nell'aggiornamento","error")}}async function L(s){if(confirm("Sei sicuro di voler eliminare questo ordine?"))try{await H(s),i("Ordine eliminato","success"),l()}catch(t){console.error("Error deleting order:",t),i("Errore nell'eliminazione","error")}}async function R(s){E(s);try{const t=await Q(s.id);D(t),o(!0)}catch(t){console.error("Error loading order items:",t),i("Errore nel caricamento dettagli","error")}}const m=w.filter(s=>{if(p!=="all"&&s.status!==p)return!1;if(u){const t=u.toLowerCase();return s.id.toString().includes(t)||s.customer_name?.toLowerCase().includes(t)||s.table_name?.toLowerCase().includes(t)}return!0}),F={pending:m.filter(s=>s.status==="pending"),preparing:m.filter(s=>s.status==="preparing"),ready:m.filter(s=>s.status==="ready"),delivered:m.filter(s=>s.status==="delivered")};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Ordini"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Gestisci gli ordini del ristorante"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[b&&e.jsx("div",{className:`flex items-center gap-2 px-3 py-2 rounded-xl text-sm ${f?"bg-emerald-500/20 text-emerald-400":"bg-amber-500/20 text-amber-400"}`,children:f?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Live"})]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Offline"})]})}),e.jsx("button",{onClick:l,className:"btn-secondary",children:e.jsx(B,{className:"w-5 h-5"})}),e.jsxs($,{to:"/orders/new",className:"btn-primary",children:[e.jsx(J,{className:"w-5 h-5"}),"Nuovo Ordine"]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-xs",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"Cerca ordine...",value:u,onChange:s=>_(s.target.value),className:"input pl-10"})]}),e.jsx("input",{type:"date",value:h,onChange:s=>S(s.target.value),className:"input w-auto"}),e.jsxs("select",{value:p,onChange:s=>O(s.target.value),className:"select w-auto",children:[e.jsx("option",{value:"all",children:"Tutti gli stati"}),e.jsx("option",{value:"pending",children:"In Attesa"}),e.jsx("option",{value:"preparing",children:"In Preparazione"}),e.jsx("option",{value:"ready",children:"Pronto"}),e.jsx("option",{value:"delivered",children:"Consegnato"})]})]}),k?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4",children:["pending","preparing","ready","delivered"].map(s=>{const t=d[s],c=F[s];return e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t.icon,{className:"w-5 h-5"}),e.jsx("span",{className:"font-semibold",children:t.label})]}),e.jsx("span",{className:t.color,children:c.length})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:c.length===0?e.jsx("p",{className:"text-dark-500 text-center py-4 text-sm",children:"Nessun ordine"}):c.map(r=>e.jsxs("div",{className:"bg-dark-900 rounded-xl p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white",children:["Ordine #",r.id]}),e.jsxs("p",{className:"text-sm text-dark-400",children:[v[r.order_type],r.table_name&&` - ${r.table_name}`]}),r.customer_name&&e.jsx("p",{className:"text-sm text-dark-400",children:r.customer_name})]}),e.jsxs("p",{className:"font-bold text-primary-400",children:["€",r.total.toFixed(2)]})]}),r.notes&&e.jsx("p",{className:"text-sm text-dark-400 bg-dark-800 p-2 rounded-lg",children:r.notes}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>R(r),className:"btn-ghost btn-sm flex-1",children:[e.jsx(X,{className:"w-4 h-4"}),"Dettagli"]}),t.next&&e.jsxs("button",{onClick:()=>N(r),className:"btn-success btn-sm flex-1",children:[e.jsx(j,{className:"w-4 h-4"}),s==="pending"?"Prepara":s==="preparing"?"Pronto":"Consegna"]})]})]},r.id))})]},s)})}),e.jsx(U,{isOpen:I,onClose:()=>o(!1),title:`Ordine #${a?.id}`,size:"lg",children:a&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tipo"}),e.jsx("p",{className:"font-medium text-white",children:v[a.order_type]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Stato"}),e.jsx("span",{className:d[a.status].color,children:d[a.status].label})]}),a.table_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Tavolo"}),e.jsx("p",{className:"font-medium text-white",children:a.table_name})]}),a.customer_name&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Cliente"}),e.jsx("p",{className:"font-medium text-white",children:a.customer_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"Pagamento"}),e.jsx("p",{className:"font-medium text-white capitalize",children:a.payment_method==="cash"?"Contanti":a.payment_method==="card"?"Carta":"Online"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400",children:"SMAC"}),e.jsx("p",{className:"font-medium text-white",children:a.smac_passed?"Sì":"No"})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400 mb-2",children:"Prodotti"}),e.jsx("div",{className:"space-y-2",children:P.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-900 rounded-xl",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-white",children:[s.quantity,"x ",s.menu_item_name]}),s.notes&&e.jsx("p",{className:"text-sm text-dark-400",children:s.notes})]}),e.jsxs("p",{className:"font-medium text-primary-400",children:["€",(s.price*s.quantity).toFixed(2)]})]},s.id))})]}),a.notes&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-dark-400 mb-2",children:"Note"}),e.jsx("p",{className:"p-3 bg-dark-900 rounded-xl text-white",children:a.notes})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-dark-700",children:[e.jsx("span",{className:"text-lg font-semibold text-white",children:"Totale"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-400",children:["€",a.total.toFixed(2)]})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4",children:[d[a.status].next&&e.jsxs("button",{onClick:()=>{N(a),o(!1)},className:"btn-success flex-1",children:[e.jsx(j,{className:"w-5 h-5"}),"Avanza Stato"]}),e.jsx("button",{onClick:()=>{L(a.id),o(!1)},className:"btn-danger",children:e.jsx(y,{className:"w-5 h-5"})})]})]})})]})}export{re as Orders};
