import{r as a,k as z,N as P,a1 as Q,s as n,j as e,C as v,P as y,e as T,a2 as A,a3 as L,a4 as $}from"./index-tmRa7dq2.js";import{S as D}from"./search-B4gV-ndK.js";import{P as G}from"./plus-BAVCWZw2.js";function J(){const[g,w]=a.useState([]),[h,k]=a.useState([]),[p,I]=a.useState([]),[C,S]=a.useState(!0),[d,j]=a.useState(null),[f,E]=a.useState(""),[c,N]=a.useState(""),[o,b]=a.useState("");a.useEffect(()=>{m()},[]);async function m(){try{const[t,s,r]=await Promise.all([z(),P(),Q()]);w(t),k(s),I(r),t.length>0&&!d&&j(t[0].id)}catch(t){console.error("Error loading data:",t),n("Errore nel caricamento dati","error")}finally{S(!1)}}const _=g.filter(t=>t.name.toLowerCase().includes(f.toLowerCase())),x=p.filter(t=>t.menu_item_id===d),l=g.find(t=>t.id===d),M=h.filter(t=>!x.some(s=>s.ingredient_id===t.id));async function F(){if(!d||!c||!o){n("Seleziona ingrediente e quantità","warning");return}try{await $({menu_item_id:d,ingredient_id:Number(c),quantity:parseFloat(o)}),n("Ingrediente aggiunto alla ricetta","success"),N(""),b(""),m()}catch(t){console.error("Error adding ingredient:",t),n("Errore nell'aggiunta","error")}}async function R(t,s){try{await A(t,{quantity:s}),n("Quantità aggiornata","success"),m()}catch(r){console.error("Error updating quantity:",r),n("Errore nell'aggiornamento","error")}}async function q(t){try{await L(t),n("Ingrediente rimosso","success"),m()}catch(s){console.error("Error removing ingredient:",s),n("Errore nella rimozione","error")}}const u=x.reduce((t,s)=>{const r=h.find(i=>i.id===s.ingredient_id);return t+(r?r.cost*s.quantity:0)},0);return C?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestione Ricette"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Collega gli ingredienti ai piatti per il calcolo automatico delle scorte"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-4 h-[calc(100vh-160px)]",children:[e.jsxs("div",{className:"col-span-4 bg-dark-800 rounded-xl border border-dark-700 flex flex-col",children:[e.jsx("div",{className:"p-3 border-b border-dark-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"Cerca piatto...",value:f,onChange:t=>E(t.target.value),className:"input pl-9 py-2 text-sm"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:_.map(t=>{const r=p.filter(i=>i.menu_item_id===t.id).length>0;return e.jsx("button",{onClick:()=>j(t.id),className:`w-full p-3 text-left border-b border-dark-700 transition-colors ${d===t.id?"bg-primary-500/20 border-l-2 border-l-primary-500":"hover:bg-dark-700"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white text-sm",children:t.name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",t.price.toFixed(2)]})]}),e.jsx("div",{className:`w-2 h-2 rounded-full ${r?"bg-emerald-500":"bg-amber-500"}`})]})},t.id)})}),e.jsx("div",{className:"p-3 border-t border-dark-700 text-xs text-dark-400",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),e.jsx("span",{children:"Con ricetta"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500 ml-2"}),e.jsx("span",{children:"Senza ricetta"})]})})]}),e.jsx("div",{className:"col-span-8 bg-dark-800 rounded-xl border border-dark-700 flex flex-col",children:l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 border-b border-dark-700",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(v,{className:"w-6 h-6 text-primary-400"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:l.name}),e.jsxs("p",{className:"text-sm text-dark-400",children:["Prezzo: €",l.price.toFixed(2)," | Costo ingredienti: €",u.toFixed(2)," |"," ",e.jsxs("span",{className:u>0?l.price-u>0?"text-emerald-400":"text-red-400":"text-dark-400",children:["Margine: €",(l.price-u).toFixed(2)]})]})]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300 mb-3",children:"Ingredienti nella ricetta"}),x.length===0?e.jsxs("div",{className:"text-center py-8 text-dark-400",children:[e.jsx(y,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nessun ingrediente configurato"}),e.jsx("p",{className:"text-sm",children:"Aggiungi ingredienti qui sotto"})]}):e.jsx("div",{className:"space-y-2",children:x.map(t=>{const s=h.find(i=>i.id===t.ingredient_id),r=s?s.cost*t.quantity:0;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-dark-900 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(y,{className:"w-5 h-5 text-dark-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:t.ingredient_name}),e.jsxs("p",{className:"text-xs text-dark-400",children:["€",s?.cost.toFixed(2),"/",t.unit," → Costo: €",r.toFixed(3)]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",step:"0.01",min:"0",value:t.quantity,onChange:i=>R(t.id,parseFloat(i.target.value)||0),className:"w-20 bg-dark-800 border border-dark-600 rounded px-2 py-1 text-sm text-center"}),e.jsx("span",{className:"text-sm text-dark-400 w-8",children:t.unit}),e.jsx("button",{onClick:()=>q(t.id),className:"p-1.5 text-red-400 hover:bg-red-500/20 rounded transition-colors",children:e.jsx(T,{className:"w-4 h-4"})})]})]},t.id)})})]}),e.jsxs("div",{className:"p-4 border-t border-dark-700 bg-dark-900/50",children:[e.jsx("h3",{className:"text-sm font-medium text-dark-300 mb-2",children:"Aggiungi ingrediente"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:c,onChange:t=>N(t.target.value?Number(t.target.value):""),className:"input flex-1 py-2 text-sm",children:[e.jsx("option",{value:"",children:"Seleziona ingrediente..."}),M.map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.unit,")"]},t.id))]}),e.jsx("input",{type:"number",step:"0.01",min:"0",placeholder:"Qtà",value:o,onChange:t=>b(t.target.value),className:"input w-24 py-2 text-sm"}),e.jsx("button",{onClick:F,disabled:!c||!o,className:"btn-primary px-4 py-2",children:e.jsx(G,{className:"w-4 h-4"})})]})]})]}):e.jsx("div",{className:"flex-1 flex items-center justify-center text-dark-400",children:e.jsxs("div",{className:"text-center",children:[e.jsx(v,{className:"w-16 h-16 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Seleziona un piatto dalla lista"})]})})})]})]})}export{J as Recipes};
