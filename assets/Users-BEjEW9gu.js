import{d as b,r as o,aI as q,A as f,B as c,s as n,j as e,R as $,aJ as g,aK as J,e as B}from"./index-B0wSphca.js";import{M as U}from"./Modal-BWrzqEB0.js";import{P as F}from"./plus-DQ_6ynAC.js";import{S as G}from"./search-CcVOZ1ut.js";import{P as H}from"./pen-B-L-1BQG.js";const V=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],w=b("shield-alert",V);const K=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],y=b("shield-check",K);const X=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],k=b("user-check",X);const Q=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],A=b("user-x",Q);function ae(){const[i,m]=o.useState([]),[E,S]=o.useState(!0),[N,M]=o.useState(""),[_,x]=o.useState(!1),[l,C]=o.useState(null),[v,p]=o.useState(null),[a,d]=o.useState({username:"",password:"",name:"",role:"staff"}),{user:h}=q();o.useEffect(()=>{u()},[]);async function u(){S(!0);try{if(f&&c){const{data:s,error:t}=await c.from("users").select("*").order("name");if(t)throw t;m(s||[])}else{const s=JSON.parse(localStorage.getItem("kebab_users")||"[]");m(s)}}catch(s){console.error("Errore caricamento utenti:",s),n("Errore nel caricamento utenti","error")}S(!1)}const z=i.filter(s=>s.name.toLowerCase().includes(N.toLowerCase())||s.username.toLowerCase().includes(N.toLowerCase()));function L(){C(null),d({username:"",password:"",name:"",role:"staff"}),x(!0)}function O(s){C(s),d({username:s.username,password:"",name:s.name,role:s.role}),x(!0)}async function R(){if(!a.username||!a.name){n("Username e nome sono obbligatori","warning");return}if(!l&&!a.password){n("La password è obbligatoria per i nuovi utenti","warning");return}if(i.find(t=>t.username.toLowerCase()===a.username.toLowerCase()&&t.id!==l?.id)){n("Username già esistente","error");return}try{if(f&&c){if(l){const t={username:a.username,name:a.name,role:a.role};a.password&&(t.password=a.password);const{error:r}=await c.from("users").update(t).eq("id",l.id);if(r)throw r;n("Utente modificato con successo","success")}else{const{error:t}=await c.from("users").insert({username:a.username,password:a.password,name:a.name,role:a.role,active:!0});if(t)throw t;n("Utente creato con successo","success")}await u()}else{let t;if(l)t=i.map(r=>r.id===l.id?{...r,username:a.username,name:a.name,role:a.role,...a.password&&{password:a.password}}:r),n("Utente modificato con successo","success");else{const r={id:Date.now(),username:a.username,password:a.password,name:a.name,role:a.role,active:!0,created_at:new Date().toISOString()};t=[...i,r],n("Utente creato con successo","success")}localStorage.setItem("kebab_users",JSON.stringify(t)),m(t)}x(!1)}catch(t){console.error("Errore salvataggio utente:",t),n("Errore nel salvataggio","error")}}async function D(s){if(s===h?.id){n("Non puoi disattivare il tuo account","error");return}const t=i.find(r=>r.id===s);if(t)try{if(f&&c){const{error:r}=await c.from("users").update({active:!t.active}).eq("id",s);if(r)throw r;await u()}else{const r=i.map(j=>j.id===s?{...j,active:!j.active}:j);localStorage.setItem("kebab_users",JSON.stringify(r)),m(r)}n("Stato utente aggiornato","success")}catch(r){console.error("Errore aggiornamento stato:",r),n("Errore nell'aggiornamento","error")}}async function T(s){if(s===h?.id){n("Non puoi eliminare il tuo account","error");return}try{if(f&&c){const{error:t}=await c.from("users").delete().eq("id",s);if(t)throw t;await u()}else{const t=i.filter(r=>r.id!==s);localStorage.setItem("kebab_users",JSON.stringify(t)),m(t)}p(null),n("Utente eliminato","success")}catch(t){console.error("Errore eliminazione utente:",t),n("Errore nell'eliminazione","error")}}function I(s){switch(s){case"superadmin":return e.jsx(w,{className:"w-4 h-4 text-red-400"});case"admin":return e.jsx(y,{className:"w-4 h-4 text-amber-400"});case"staff":return e.jsx(g,{className:"w-4 h-4 text-blue-400"})}}function P(s){switch(s){case"superadmin":return"bg-red-500/20 text-red-400 border border-red-500/30";case"admin":return"bg-amber-500/20 text-amber-400 border border-amber-500/30";case"staff":return"bg-blue-500/20 text-blue-400 border border-blue-500/30"}}return E?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Gestione Utenti"}),e.jsx("p",{className:"text-dark-400 text-sm",children:"Crea e gestisci gli account del sistema"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"btn-secondary btn-sm",children:e.jsx($,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:L,className:"btn-primary btn-sm",children:[e.jsx(F,{className:"w-4 h-4"}),"Nuovo Utente"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Totale Utenti"}),e.jsx("p",{className:"stat-value",children:i.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(g,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Super Admin"}),e.jsx("p",{className:"stat-value",children:i.filter(s=>s.role==="superadmin").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center",children:e.jsx(w,{className:"w-6 h-6 text-red-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Admin"}),e.jsx("p",{className:"stat-value",children:i.filter(s=>s.role==="admin").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(y,{className:"w-6 h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Staff"}),e.jsx("p",{className:"stat-value",children:i.filter(s=>s.role==="staff").length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-emerald-400"})})]})})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"Cerca utente...",value:N,onChange:s=>M(s.target.value),className:"input pl-10"})]}),e.jsx("div",{className:"card",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Utente"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Ruolo"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Ultimo Accesso"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:z.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-dark-700 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-semibold text-primary-400",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),s.id===h?.id&&e.jsx("p",{className:"text-xs text-primary-400",children:"(Tu)"})]})]})}),e.jsx("td",{children:e.jsx("p",{className:"font-mono text-dark-300",children:s.username})}),e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium ${P(s.role)}`,children:[I(s.role),J[s.role]]})}),e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium ${s.active?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:s.active?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"w-3 h-3"}),"Attivo"]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-3 h-3"}),"Disattivato"]})})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400 text-sm",children:s.last_login?new Date(s.last_login).toLocaleString("it-IT"):"Mai"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>O(s),className:"btn-secondary btn-sm",title:"Modifica",children:e.jsx(H,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D(s.id),className:`btn-sm ${s.active?"btn-secondary":"btn-primary"}`,title:s.active?"Disattiva":"Attiva",disabled:s.id===h?.id,children:s.active?e.jsx(A,{className:"w-4 h-4"}):e.jsx(k,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(s.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",title:"Elimina",disabled:s.id===h?.id,children:e.jsx(B,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsxs("div",{className:"bg-dark-800 rounded-xl border border-dark-700 p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-3",children:"Permessi per Ruolo"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(w,{className:"w-5 h-5 text-red-400"}),e.jsx("span",{className:"font-medium text-red-400",children:"Super Admin"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Accesso completo: Dashboard, Ordini, Menu, Tavoli, Inventario, Ricette, Personale, Report, SMAC, Impostazioni, Gestione Utenti"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(y,{className:"w-5 h-5 text-amber-400"}),e.jsx("span",{className:"font-medium text-amber-400",children:"Admin"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Accesso operativo: Dashboard, Ordini, Menu, Tavoli, Inventario, Ricette, Personale"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(g,{className:"w-5 h-5 text-blue-400"}),e.jsx("span",{className:"font-medium text-blue-400",children:"Staff"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Solo servizio: Nuovo Ordine, Ordini, Tavoli"})]})]})]}),e.jsx(U,{isOpen:_,onClose:()=>x(!1),title:l?"Modifica Utente":"Nuovo Utente",size:"md",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>d({...a,name:s.target.value}),placeholder:"Es: Mario Rossi",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:a.username,onChange:s=>d({...a,username:s.target.value.toLowerCase()}),placeholder:"Es: mario.rossi",className:"input font-mono"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:["Password ",l?"(lascia vuoto per non modificare)":"*"]}),e.jsx("input",{type:"password",value:a.password,onChange:s=>d({...a,password:s.target.value}),placeholder:l?"••••••••":"Inserisci password",className:"input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Ruolo *"}),e.jsxs("select",{value:a.role,onChange:s=>d({...a,role:s.target.value}),className:"input",children:[e.jsx("option",{value:"staff",children:"Staff - Solo servizio"}),e.jsx("option",{value:"admin",children:"Admin - Operativo"}),e.jsx("option",{value:"superadmin",children:"Super Admin - Accesso completo"})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:R,className:"btn-primary",children:l?"Salva Modifiche":"Crea Utente"})]})]})}),e.jsx(U,{isOpen:v!==null,onClose:()=>p(null),title:"Conferma Eliminazione",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-300",children:"Sei sicuro di voler eliminare questo utente? L'azione è irreversibile."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(null),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:()=>v&&T(v),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-medium transition-colors",children:"Elimina"})]})]})})]})}export{ae as Users};
