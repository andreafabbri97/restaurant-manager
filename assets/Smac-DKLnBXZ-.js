import{d as S,r as d,o as A,s as o,j as e,R as M,c as h,an as u,h as O,p as E,q as y}from"./index-Cz_yVV27.js";import{C as z}from"./calendar-Di9Vxg-o.js";const P=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]],k=S("file-check",P);const T=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m14.5 12.5-5 5",key:"b62r18"}],["path",{d:"m9.5 12.5 5 5",key:"1rk7el"}]],$=S("file-x",T);async function w(a,m){if(E&&y){const{error:i}=await y.from("orders").update({smac_passed:m}).eq("id",a);if(i)throw i}else{const i="kebab_",l=JSON.parse(localStorage.getItem(i+"orders")||"[]"),r=l.findIndex(p=>p.id===a);r!==-1&&(l[r].smac_passed=m,localStorage.setItem(i+"orders",JSON.stringify(l)))}}function I(){const[a,m]=d.useState([]),[i,l]=d.useState(!0),[r,p]=d.useState(new Date().toISOString().split("T")[0]),[n,j]=d.useState("all");d.useEffect(()=>{x()},[r]);async function x(){l(!0);try{const s=await A(r);m(s.filter(t=>t.status!=="cancelled"))}catch(s){console.error("Error loading orders:",s),o("Errore nel caricamento ordini","error")}finally{l(!1)}}const f=a.filter(s=>n==="passed"?s.smac_passed:n==="not_passed"?!s.smac_passed:!0),N=a.filter(s=>s.smac_passed).reduce((s,t)=>s+t.total,0),g=a.filter(s=>!s.smac_passed).reduce((s,t)=>s+t.total,0),b=a.filter(s=>s.smac_passed).length,c=a.filter(s=>!s.smac_passed).length;async function C(s){try{await w(s.id,!s.smac_passed),o(s.smac_passed?"SMAC rimossa":"SMAC registrata","success"),x()}catch(t){console.error("Error updating SMAC:",t),o("Errore nell'aggiornamento","error")}}async function _(){if(confirm(`Segnare tutti i ${c} ordini come SMAC passata?`))try{for(const s of a.filter(t=>!t.smac_passed))await w(s.id,!0);o(`${c} ordini segnati come SMAC passata`,"success"),x()}catch(s){console.error("Error updating SMAC:",s),o("Errore nell'aggiornamento","error")}}const v=s=>new Date(s).toLocaleDateString("it-IT",{weekday:"long",day:"numeric",month:"long",year:"numeric"});return i?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Dichiarazioni SMAC"}),e.jsx("p",{className:"text-dark-400 mt-1",children:"Gestione SMAC per la dichiarazione fiscale di San Marino"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:x,className:"btn-secondary",children:e.jsx(M,{className:"w-5 h-5"})}),c>0&&e.jsxs("button",{onClick:_,className:"btn-primary",children:[e.jsx(h,{className:"w-5 h-5"}),"Segna Tutti come Passati"]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(z,{className:"w-5 h-5 text-dark-400"}),e.jsx("input",{type:"date",value:r,onChange:s=>p(s.target.value),className:"input w-auto"}),e.jsx("span",{className:"text-dark-400",children:v(r)})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Ordini Totali"}),e.jsx("p",{className:"stat-value",children:a.length})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card glow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"SMAC Passata"}),e.jsxs("p",{className:"stat-value text-emerald-400",children:["€",N.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:[b," ordini"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(h,{className:"w-6 h-6 text-emerald-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"SMAC Non Passata"}),e.jsxs("p",{className:"stat-value text-amber-400",children:["€",g.toFixed(2)]}),e.jsxs("p",{className:"text-xs text-dark-500 mt-1",children:[c," ordini"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(u,{className:"w-6 h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label",children:"Incasso Giornata"}),e.jsxs("p",{className:"stat-value",children:["€",(N+g).toFixed(2)]})]}),e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary-500/20 flex items-center justify-center",children:e.jsx(k,{className:"w-6 h-6 text-primary-400"})})]})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:()=>j("all"),className:`px-4 py-2 rounded-xl font-medium transition-all ${n==="all"?"bg-primary-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:["Tutti (",a.length,")"]}),e.jsx("button",{onClick:()=>j("passed"),className:`px-4 py-2 rounded-xl font-medium transition-all ${n==="passed"?"bg-emerald-500 text-white":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),"Passata (",b,")"]})}),e.jsx("button",{onClick:()=>j("not_passed"),className:`px-4 py-2 rounded-xl font-medium transition-all ${n==="not_passed"?"bg-amber-500 text-dark-900":"bg-dark-800 text-dark-300 hover:bg-dark-700"}`,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Non Passata (",c,")"]})})]}),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsxs("h2",{className:"font-semibold text-white",children:["Ordini del ",v(r)]})}),e.jsx("div",{className:"divide-y divide-dark-700",children:f.length===0?e.jsxs("div",{className:"p-8 text-center text-dark-400",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nessun ordine trovato per questa data"})]}):f.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 hover:bg-dark-900/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-xl flex items-center justify-center ${s.smac_passed?"bg-emerald-500/20":"bg-amber-500/20"}`,children:s.smac_passed?e.jsx(h,{className:"w-6 h-6 text-emerald-400"}):e.jsx(u,{className:"w-6 h-6 text-amber-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-white",children:["Ordine #",s.id]}),e.jsxs("div",{className:"flex items-center gap-3 text-sm text-dark-400",children:[e.jsx("span",{children:s.order_type==="dine_in"?`Tavolo ${s.table_name||s.table_id}`:s.order_type==="takeaway"?"Asporto":"Domicilio"}),e.jsx("span",{children:"•"}),e.jsx("span",{children:s.payment_method==="cash"?"Contanti":s.payment_method==="card"?"Carta":"Online"}),s.customer_name&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsx("span",{children:s.customer_name})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-xl font-bold text-primary-400",children:["€",s.total.toFixed(2)]}),e.jsx("p",{className:`text-sm ${s.smac_passed?"text-emerald-400":"text-amber-400"}`,children:s.smac_passed?"SMAC Passata":"SMAC Non Passata"})]}),e.jsx("button",{onClick:()=>C(s),className:`p-3 rounded-xl transition-all ${s.smac_passed?"bg-emerald-500 text-white hover:bg-emerald-600":"bg-dark-700 text-dark-300 hover:bg-amber-500 hover:text-dark-900"}`,title:s.smac_passed?"Rimuovi SMAC":"Segna come SMAC passata",children:e.jsx(O,{className:"w-5 h-5"})})]})]},s.id))})]}),e.jsxs("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-xl p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-400 mb-2",children:"Cos'è la SMAC?"}),e.jsxs("p",{className:"text-sm text-dark-300",children:["La ",e.jsx("strong",{children:"SMAC"})," (Carta Servizi) è il sistema di San Marino per la tracciabilità delle transazioni commerciali. Quando un cliente presenta la sua carta SMAC al momento del pagamento, l'importo viene registrato per beneficiare di detrazioni fiscali. Questa sezione ti permette di tenere traccia di quali ordini hanno avuto la SMAC passata."]})]})]})}export{I as Smac};
