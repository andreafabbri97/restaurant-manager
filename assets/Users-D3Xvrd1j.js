import{d as g,u as X,r as d,aD as K,E as b,F as c,aE as Q,s as l,j as e,R as W,a$ as k,b0 as O,e as R}from"./index-CR4UKEb8.js";import{M as I}from"./Modal-BXKHmram.js";import{P as Y}from"./plus-CseZsL1d.js";import{S as Z}from"./search-BgH76lKb.js";import{L as $}from"./link-2-s7iJGhA7.js";import{P}from"./pen-2usUqnMr.js";const ee=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],C=g("shield-alert",ee);const se=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],S=g("shield-check",se);const te=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],f=g("user-check",te);const ae=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],N=g("user-x",ae);function oe(){X();const[n,x]=d.useState([]),[v,q]=d.useState([]),[F,_]=d.useState(!0),[w,J]=d.useState(""),[B,h]=d.useState(!1),[r,U]=d.useState(null),[y,p]=d.useState(null),[a,m]=d.useState({username:"",password:"",name:"",role:"staff",employee_id:null}),{user:o}=K();d.useEffect(()=>{u()},[]);async function u(){_(!0);try{if(b&&c){const{data:t,error:i}=await c.from("users").select("*").order("name");if(i)throw i;x(t||[])}else{const t=JSON.parse(localStorage.getItem("kebab_users")||"[]");x(t)}const s=await Q();q(s)}catch(s){console.error("Errore caricamento dati:",s),l("Errore nel caricamento dati","error")}_(!1)}const E=v.filter(s=>!n.find(i=>i.employee_id===s.id&&i.id!==r?.id));function A(s){const t=n.find(i=>i.id===s);if(t?.employee_id)return v.find(i=>i.id===t.employee_id)}const M=n.filter(s=>s.name.toLowerCase().includes(w.toLowerCase())||s.username.toLowerCase().includes(w.toLowerCase()));function G(){U(null),m({username:"",password:"",name:"",role:"staff",employee_id:null}),h(!0)}function L(s){U(s),m({username:s.username,password:"",name:s.name,role:s.role,employee_id:s.employee_id||null}),h(!0)}async function H(){if(!a.username||!a.name){l("Username e nome sono obbligatori","warning");return}if(!r&&!a.password){l("La password è obbligatoria per i nuovi utenti","warning");return}if(n.find(t=>t.username.toLowerCase()===a.username.toLowerCase()&&t.id!==r?.id)){l("Username già esistente","error");return}try{if(b&&c){if(r){const t={username:a.username,name:a.name,role:a.role,employee_id:a.employee_id};a.password&&(t.password=a.password);const{error:i}=await c.from("users").update(t).eq("id",r.id);if(i)throw i;l("Utente modificato con successo","success")}else{const{error:t}=await c.from("users").insert({username:a.username,password:a.password,name:a.name,role:a.role,employee_id:a.employee_id||null,active:!0});if(t)throw t;l("Utente creato con successo","success")}await u()}else{let t;if(r)t=n.map(i=>i.id===r.id?{...i,username:a.username,name:a.name,role:a.role,employee_id:a.employee_id||void 0,...a.password&&{password:a.password}}:i),l("Utente modificato con successo","success");else{const i={id:Date.now(),username:a.username,password:a.password,name:a.name,role:a.role,employee_id:a.employee_id||void 0,active:!0,created_at:new Date().toISOString()};t=[...n,i],l("Utente creato con successo","success")}localStorage.setItem("kebab_users",JSON.stringify(t)),x(t)}h(!1)}catch(t){console.error("Errore salvataggio utente:",t),l("Errore nel salvataggio","error")}}async function D(s){if(s===o?.id){l("Non puoi disattivare il tuo account","error");return}const t=n.find(i=>i.id===s);if(t)try{if(b&&c){const{error:i}=await c.from("users").update({active:!t.active}).eq("id",s);if(i)throw i;await u()}else{const i=n.map(j=>j.id===s?{...j,active:!j.active}:j);localStorage.setItem("kebab_users",JSON.stringify(i)),x(i)}l("Stato utente aggiornato","success")}catch(i){console.error("Errore aggiornamento stato:",i),l("Errore nell'aggiornamento","error")}}async function V(s){if(s===o?.id){l("Non puoi eliminare il tuo account","error");return}try{if(b&&c){const{error:t}=await c.from("users").delete().eq("id",s);if(t)throw t;await u()}else{const t=n.filter(i=>i.id!==s);localStorage.setItem("kebab_users",JSON.stringify(t)),x(t)}p(null),l("Utente eliminato","success")}catch(t){console.error("Errore eliminazione utente:",t),l("Errore nell'eliminazione","error")}}function z(s){switch(s){case"superadmin":return e.jsx(C,{className:"w-4 h-4 text-red-400"});case"admin":return e.jsx(S,{className:"w-4 h-4 text-amber-400"});case"staff":return e.jsx(k,{className:"w-4 h-4 text-blue-400"})}}function T(s){switch(s){case"superadmin":return"bg-red-500/20 text-red-400 border border-red-500/30";case"admin":return"bg-amber-500/20 text-amber-400 border border-amber-500/30";case"staff":return"bg-blue-500/20 text-blue-400 border border-blue-500/30"}}return F?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary-500"})}):e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-white",children:"Gestione Utenti"}),e.jsx("p",{className:"text-dark-400 text-xs sm:text-sm",children:"Crea e gestisci gli account del sistema"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:u,className:"btn-secondary btn-sm",children:e.jsx(W,{className:"w-4 h-4"})}),e.jsxs("button",{onClick:G,className:"btn-primary btn-sm flex-1 sm:flex-none justify-center",children:[e.jsx(Y,{className:"w-4 h-4"}),"Nuovo Utente"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4",children:[e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label text-xs",children:"Totale Utenti"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:n.length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-blue-500/20 flex items-center justify-center",children:e.jsx(k,{className:"w-4 h-4 sm:w-6 sm:h-6 text-blue-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label text-xs",children:"Super Admin"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:n.filter(s=>s.role==="superadmin").length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-red-500/20 flex items-center justify-center",children:e.jsx(C,{className:"w-4 h-4 sm:w-6 sm:h-6 text-red-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label text-xs",children:"Admin"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:n.filter(s=>s.role==="admin").length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-amber-500/20 flex items-center justify-center",children:e.jsx(S,{className:"w-4 h-4 sm:w-6 sm:h-6 text-amber-400"})})]})}),e.jsx("div",{className:"stat-card",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"stat-label text-xs",children:"Staff"}),e.jsx("p",{className:"stat-value text-lg sm:text-2xl",children:n.filter(s=>s.role==="staff").length})]}),e.jsx("div",{className:"w-8 h-8 sm:w-12 sm:h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center",children:e.jsx(f,{className:"w-4 h-4 sm:w-6 sm:h-6 text-emerald-400"})})]})})]}),e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 sm:w-5 sm:h-5 text-dark-400"}),e.jsx("input",{type:"text",placeholder:"Cerca utente...",value:w,onChange:s=>J(s.target.value),className:"input pl-9 sm:pl-10 text-sm sm:text-base"})]}),e.jsx("div",{className:"card hidden md:block",children:e.jsx("div",{className:"table-container",children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Utente"}),e.jsx("th",{children:"Username"}),e.jsx("th",{children:"Ruolo"}),e.jsx("th",{children:"Dipendente"}),e.jsx("th",{children:"Stato"}),e.jsx("th",{children:"Ultimo Accesso"}),e.jsx("th",{children:"Azioni"})]})}),e.jsx("tbody",{children:M.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-dark-700 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-semibold text-primary-400",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-white",children:s.name}),s.id===o?.id&&e.jsx("p",{className:"text-xs text-primary-400",children:"(Tu)"})]})]})}),e.jsx("td",{children:e.jsx("p",{className:"font-mono text-dark-300",children:s.username})}),e.jsx("td",{children:e.jsxs("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium ${T(s.role)}`,children:[z(s.role),O[s.role]]})}),e.jsx("td",{children:(()=>{const t=A(s.id);return t?e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium bg-primary-500/20 text-primary-400",children:[e.jsx($,{className:"w-3 h-3"}),t.name]}):e.jsx("span",{className:"text-dark-500 text-sm",children:"-"})})()}),e.jsx("td",{children:e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-sm font-medium ${s.active?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:s.active?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-3 h-3"}),"Attivo"]}):e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"w-3 h-3"}),"Disattivato"]})})}),e.jsx("td",{children:e.jsx("p",{className:"text-dark-400 text-sm",children:s.last_login?new Date(s.last_login).toLocaleString("it-IT"):"Mai"})}),e.jsx("td",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>L(s),className:"btn-secondary btn-sm",title:"Modifica",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>D(s.id),className:`btn-sm ${s.active?"btn-secondary":"btn-primary"}`,title:s.active?"Disattiva":"Attiva",disabled:s.id===o?.id,children:s.active?e.jsx(N,{className:"w-4 h-4"}):e.jsx(f,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>p(s.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",title:"Elimina",disabled:s.id===o?.id,children:e.jsx(R,{className:"w-4 h-4"})})]})})]},s.id))})]})})}),e.jsx("div",{className:"md:hidden space-y-3",children:M.map(s=>{const t=A(s.id);return e.jsxs("div",{className:"card p-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-dark-700 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-lg font-semibold text-primary-400",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("p",{className:"font-medium text-white text-sm truncate",children:s.name}),s.id===o?.id&&e.jsx("span",{className:"text-xs text-primary-400",children:"(Tu)"})]}),e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium flex-shrink-0 ${s.active?"bg-emerald-500/20 text-emerald-400":"bg-red-500/20 text-red-400"}`,children:[s.active?e.jsx(f,{className:"w-3 h-3"}):e.jsx(N,{className:"w-3 h-3"}),s.active?"Attivo":"Disattivato"]})]}),e.jsxs("p",{className:"font-mono text-dark-400 text-xs mt-0.5",children:["@",s.username]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-2",children:[e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium ${T(s.role)}`,children:[z(s.role),O[s.role]]}),t&&e.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium bg-primary-500/20 text-primary-400",children:[e.jsx($,{className:"w-3 h-3"}),t.name]})]}),e.jsxs("p",{className:"text-dark-500 text-xs mt-2",children:["Ultimo accesso: ",s.last_login?new Date(s.last_login).toLocaleString("it-IT"):"Mai"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-3 pt-3 border-t border-dark-700",children:[e.jsxs("button",{onClick:()=>L(s),className:"btn-secondary btn-sm flex-1 justify-center text-xs",children:[e.jsx(P,{className:"w-3.5 h-3.5"}),"Modifica"]}),e.jsxs("button",{onClick:()=>D(s.id),className:`btn-sm flex-1 justify-center text-xs ${s.active?"btn-secondary":"btn-primary"}`,disabled:s.id===o?.id,children:[s.active?e.jsx(N,{className:"w-3.5 h-3.5"}):e.jsx(f,{className:"w-3.5 h-3.5"}),s.active?"Disattiva":"Attiva"]}),e.jsx("button",{onClick:()=>p(s.id),className:"p-2 text-red-400 hover:bg-red-500/20 rounded-lg transition-colors",disabled:s.id===o?.id,children:e.jsx(R,{className:"w-4 h-4"})})]})]},s.id)})}),e.jsxs("div",{className:"bg-dark-800 rounded-xl border border-dark-700 p-3 sm:p-4",children:[e.jsx("h3",{className:"font-semibold text-white mb-2 sm:mb-3 text-sm sm:text-base",children:"Permessi per Ruolo"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4",children:[e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2.5 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 sm:mb-2",children:[e.jsx(C,{className:"w-4 h-4 sm:w-5 sm:h-5 text-red-400"}),e.jsx("span",{className:"font-medium text-red-400 text-sm",children:"Super Admin"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Accesso completo: Dashboard, Ordini, Menu, Tavoli, Inventario, Ricette, Personale, Report, SMAC, Impostazioni, Gestione Utenti"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2.5 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 sm:mb-2",children:[e.jsx(S,{className:"w-4 h-4 sm:w-5 sm:h-5 text-amber-400"}),e.jsx("span",{className:"font-medium text-amber-400 text-sm",children:"Admin"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Accesso operativo: Dashboard, Ordini, Menu, Tavoli, Inventario, Ricette, Personale"})]}),e.jsxs("div",{className:"bg-dark-900 rounded-lg p-2.5 sm:p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1.5 sm:mb-2",children:[e.jsx(k,{className:"w-4 h-4 sm:w-5 sm:h-5 text-blue-400"}),e.jsx("span",{className:"font-medium text-blue-400 text-sm",children:"Staff"})]}),e.jsx("p",{className:"text-xs text-dark-400",children:"Servizio: Nuovo Ordine, Ordini, Tavoli, I Miei Turni (solo propri turni e paga)"})]})]})]}),e.jsx(I,{isOpen:B,onClose:()=>h(!1),title:r?"Modifica Utente":"Nuovo Utente",size:"xl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>m({...a,name:s.target.value}),placeholder:"Es: Mario Rossi",className:"input"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Username *"}),e.jsx("input",{type:"text",value:a.username,onChange:s=>m({...a,username:s.target.value.toLowerCase()}),placeholder:"Es: mario.rossi",className:"input font-mono"})]})]}),e.jsxs("div",{className:"md:grid md:grid-cols-2 md:gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:["Password ",r?"(lascia vuoto per non modificare)":"*"]}),e.jsx("input",{type:"password",value:a.password,onChange:s=>m({...a,password:s.target.value}),placeholder:r?"••••••••":"Inserisci password",className:"input"})]}),e.jsxs("div",{className:"mt-4 md:mt-0",children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Ruolo *"}),e.jsxs("select",{value:a.role,onChange:s=>m({...a,role:s.target.value}),className:"input",children:[e.jsx("option",{value:"staff",children:"Staff - Solo servizio"}),e.jsx("option",{value:"admin",children:"Admin - Operativo"}),e.jsx("option",{value:"superadmin",children:"Super Admin - Accesso completo"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-dark-300 mb-1",children:"Collega a Dipendente"}),e.jsxs("select",{value:a.employee_id||"",onChange:s=>m({...a,employee_id:s.target.value?parseInt(s.target.value):null}),className:"input",children:[e.jsx("option",{value:"",children:"Nessun collegamento"}),r?.employee_id&&!E.find(s=>s.id===r.employee_id)&&e.jsxs("option",{value:r.employee_id,children:[v.find(s=>s.id===r.employee_id)?.name," (collegato)"]}),E.map(s=>e.jsxs("option",{value:s.id,children:[s.name," - ",s.role]},s.id))]}),e.jsx("p",{className:"text-xs text-dark-400 mt-1",children:"Collega l'utente a un dipendente per permettere di vedere turni e paga personali"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:H,className:"btn-primary",children:r?"Salva Modifiche":"Crea Utente"})]})]})}),e.jsx(I,{isOpen:y!==null,onClose:()=>p(null),title:"Conferma Eliminazione",size:"sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-dark-300",children:"Sei sicuro di voler eliminare questo utente? L'azione è irreversibile."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>p(null),className:"btn-secondary",children:"Annulla"}),e.jsx("button",{onClick:()=>y&&V(y),className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-xl font-medium transition-colors",children:"Elimina"})]})]})})]})}export{oe as Users};
